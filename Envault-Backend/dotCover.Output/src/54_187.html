<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\ENVAULT\Envault-Backend\DataAccessLayer\Infrastructure\LoginAndRegistrationRepository.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using ApplicationLayer.Interfaces;
using CoreModels.Entities;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace DataAccessLayer.Infrastructure
{
    public class LoginAndRegistrationRepository : ILoginAndRegistrationRepository
    {
        private readonly ApplicationDBContext _dbContext;
        public LoginAndRegistrationRepository(ApplicationDBContext dbContext)
        {
            _dbContext = dbContext;
        }
        //Checks whether the user exists or not - Used for registering customer for netbanking &amp; resetting password
        public bool CheckUserExistence(long customerId)
        {
            try
            {
                BasicDetailsEntity? customerDetails = _dbContext.Set&lt;BasicDetailsEntity&gt;().Where(account =&gt; account.CustomerId == customerId).FirstOrDefault();
                if (customerDetails != null)
                {
                    return true;
                }
                return false;
            }
            catch (Exception ex)
            {
                throw new Exception(ex.Message);
            }
        }
        //Checks whether the customer already registered for netbanking or not
        public bool IsRegisteredCustomer(long customerId)
        {
            try
            {
                LoginCredentialsEntity? loginCredentials = _dbContext.Set&lt;LoginCredentialsEntity&gt;().Where(loginData =&gt; loginData.CustomerId == customerId).FirstOrDefault();
                if (loginCredentials != null)
                {
                    return true;
                }
                return false;
            }
            catch(Exception ex)
            {
                throw new Exception(ex.Message);
            }
        }
        //Registers the customer for net banking 
        public bool RegisterNewUser(LoginCredentialsEntity loginCredentials)
        {
            try
            {
                loginCredentials.CreatedBy = _dbContext.Set&lt;BasicDetailsEntity&gt;().Where(customer =&gt; customer.CustomerId == loginCredentials.CustomerId).Select(customer =&gt; customer.CustomerEmail).FirstOrDefault();
                loginCredentials.ModifiedBy = loginCredentials.CreatedBy;
                _dbContext.Set&lt;LoginCredentialsEntity&gt;().Add(loginCredentials);
                _dbContext.SaveChanges();
                return true;
            }
            catch (Exception ex)
            {
                throw new Exception(ex.Message);
            }
        }
        //Gives security message of the customer for application authentication
        public string GetUserSecurityMessage(long customerId)
        {
            try
            {
                LoginCredentialsEntity? loginCredentials = _dbContext.Set&lt;LoginCredentialsEntity&gt;().Where(user =&gt; user.CustomerId == customerId).FirstOrDefault();
                if (loginCredentials != null)
                {
                    return loginCredentials.SecurityMessage;
                }
                return null;
            }
            catch (Exception ex)
            {
                throw new Exception(ex.Message);
            }
        }
        //Checks weather the login credentials entered by the user are correct or not
        public bool ValidateUserToLogin(long customerId, string password)
        {
            try
            {
                LoginCredentialsEntity? loginCredentials = _dbContext.Set&lt;LoginCredentialsEntity&gt;().Where(user =&gt; user.CustomerId == customerId &amp;&amp; user.CustomerPassword == password).FirstOrDefault();
                if (loginCredentials != null)
                {
                    return true;
                }
                return false;
            }
            catch (Exception ex)
            {
                throw new Exception(ex.Message);
            }
        }
        //Checks whether the user exists or not - Used for forgot customer ID
        public bool CheckUserExistenceWithAadhar(long aadharNumber)
        {
            try
            {
                BasicDetailsEntity? basicDetails = _dbContext.Set&lt;BasicDetailsEntity&gt;().Where(user =&gt; user.AadharNumber == aadharNumber).FirstOrDefault();
                if (basicDetails != null)
                    return true;
                return false;
            }
            catch (Exception ex)
            {
                throw new Exception(ex.Message);
            }
        }
        //Gives customer ID of the customer based on their aadhar number
        public long GetCustomerId(long aadharNumber)
        {
            try
            {
                long customerId = _dbContext.Set&lt;BasicDetailsEntity&gt;().Where(customer =&gt; customer.AadharNumber == aadharNumber).Select(customer =&gt; customer.CustomerId).FirstOrDefault();
                return customerId;
            }
            catch (Exception ex)
            {
                throw new Exception(ex.Message);
            }
        }
        //Resets the password of the customer - Forgot Password
        public bool ResetPassword(long customerId, string password)
        {
            try
            {
                LoginCredentialsEntity loginCredentials = _dbContext.Set&lt;LoginCredentialsEntity&gt;().Where(customer =&gt; customer.CustomerId == customerId).First();
                loginCredentials.CustomerPassword = password;
                _dbContext.SaveChanges();
                return true;
            }
            catch (Exception ex)
            {
                throw new Exception(ex.Message);
            }
        }
        
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[14,9,14,78,1],[15,9,15,10,1],[16,13,16,36,1],[17,9,17,10,1],[20,9,20,10,1],[22,13,22,14,1],[23,17,23,160,1],[24,17,24,45,1],[25,17,25,18,1],[26,21,26,33,1],[28,17,28,30,1],[30,13,30,33,1],[31,13,31,14,1],[32,17,32,49,1],[34,9,34,10,1],[37,9,37,10,1],[39,13,39,14,1],[40,17,40,173,1],[41,17,41,46,1],[42,17,42,18,1],[43,21,43,33,1],[45,17,45,30,1],[47,13,47,32,1],[48,13,48,14,1],[49,17,49,49,1],[51,9,51,10,1],[54,9,54,10,1],[56,13,56,14,1],[57,17,57,213,1],[58,17,58,74,1],[59,17,59,80,1],[60,17,60,42,1],[61,17,61,29,1],[63,13,63,33,1],[64,13,64,14,1],[65,17,65,49,1],[67,9,67,10,1],[70,9,70,10,1],[72,13,72,14,1],[73,17,73,163,1],[74,17,74,46,1],[75,17,75,18,1],[76,21,76,61,1],[78,17,78,29,1],[80,13,80,33,1],[81,13,81,14,1],[82,17,82,49,1],[84,9,84,10,1],[87,9,87,10,1],[89,13,89,14,1],[90,17,90,200,1],[91,17,91,46,1],[92,17,92,18,1],[93,21,93,33,1],[95,17,95,30,1],[97,13,97,33,1],[98,13,98,14,1],[99,17,99,49,1],[101,9,101,10,1],[104,9,104,10,1],[106,13,106,14,1],[107,17,107,155,1],[108,17,108,42,1],[109,21,109,33,1],[110,17,110,30,1],[112,13,112,33,1],[113,13,113,14,1],[114,17,114,49,1],[116,9,116,10,1],[119,9,119,10,1],[121,13,121,14,1],[122,17,122,186,1],[123,17,123,35,1],[125,13,125,33,1],[126,13,126,14,1],[127,17,127,49,1],[129,9,129,10,1],[132,9,132,10,1],[134,13,134,14,1],[135,17,135,161,1],[136,17,136,62,1],[137,17,137,42,1],[138,17,138,29,1],[140,13,140,33,1],[141,13,141,14,1],[142,17,142,49,1],[144,9,144,10,1]]);
    </script>
  </body>
</html>