<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\ENVAULT\Envault-Backend\Envault-Backend\Controllers\CustomerController.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using ApplicationLayer.Interfaces;
using BusinessLogicLayer;
using CoreModels;
using CoreModels.Entities;
using CoreModels.Models;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;

namespace Envault_Backend.Controllers
{
    [Route(&quot;api/[controller]&quot;)]
    [ApiController]
    public class CustomerController : ControllerBase
    {
        private readonly CustomerService _customerService;
        private readonly IConfiguration _configuration;
        private readonly ILogger&lt;CustomerController&gt; _logger;
        public CustomerController(IUnitOfWork unitOfWork, IConfiguration configuration, ILogger&lt;CustomerController&gt; logger)
        {
            _customerService = new CustomerService(unitOfWork);
            _configuration = configuration;
            _logger = logger;
        }
        [HttpGet]
        [Route(&quot;GetBasicDetails&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public async Task&lt;GenericResponse&gt; GetBasicDetails(long customerId)
        {
            try
            {
                BasicDetailsEntity customerDetails = await Task.FromResult(_customerService.GetBasicDetails(customerId));
                return new GenericResponse { Status = true, Data = customerDetails };
            }
            catch (Exception ex)
            {
                _logger.LogError(&quot;Error while retriving basic details&quot; + ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpGet]
        [Route(&quot;GetCustomerAddress&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public async Task&lt;GenericResponse&gt; GetCustomerAddress(long customerId)
        {
            try
            {
                CustomerAddressEntity customerDetails = await Task.FromResult(_customerService.GetCustomerAddress(customerId));
                return new GenericResponse { Status = true, Data = customerDetails };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpGet]
        [Route(&quot;GetCustomerFamilyAndNomineeDetails&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public async Task&lt;GenericResponse&gt; GetCustomerFamilyAndNomineeDetails(long customerId)
        {
            try
            {
                CustomerFamilyAndNomineeDetailsEntity customerDetails = await Task.FromResult(_customerService.GetCustomerFamilyAndNomineeDetails(customerId));
                return new GenericResponse { Status = true, Data = customerDetails };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpPost]
        [Route(&quot;EditBasicDetails&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse EditBasicDetails(BasicDetailsEntity basicDetails)
        {
            try
            {
                _customerService.EditBasicDetails(basicDetails);
                return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:dataUpdationSuccess&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpPost]
        [Route(&quot;EditCustomerAddress&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse EditCustomerAddress(CustomerAddressEntity customerAddress)
        {
            try
            {
                _customerService.EditCustomerAddress(customerAddress);
                return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:dataUpdationSuccess&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpPost]
        [Route(&quot;EditCustomerFamilyAndNomineeDetails&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse EditCustomerFamilyAndNomineeDetails(CustomerFamilyAndNomineeDetailsEntity customerFamilyAndNomineeDetails)
        {
            try
            {
                _customerService.EditCustomerFamilyAndNomineeDetails(customerFamilyAndNomineeDetails);
                return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:dataUpdationSuccess&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpGet]
        [Route(&quot;GetAllAccounts&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse GetAllAccounts(long customerId)
        {
            try
            {
                List&lt;AccountDetails&gt; accounts = _customerService.GetAllAccounts(customerId);
                return new GenericResponse { Status = true, Data = accounts };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpGet]
        [Route(&quot;KYCStatus&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse KYCStatus(long customerId)
        {
            try
            {
                string kycStatus = _customerService.KYCStatus(customerId);
                return new GenericResponse { Status = true, Data = kycStatus };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpPost]
        [Route(&quot;CompleteKYC&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse CompleteKYC(KYCModel customerKYCDetails)
        {
            try
            {
                _customerService.CompleteKYC(customerKYCDetails);
                return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:kycUploaded&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpPost]
        [Route(&quot;DepositMoney&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse DepositMoney(TransactionsEntity transactionDetails)
        {
            try
            {
                _customerService.DepositMoney(transactionDetails);
                return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:depositSuccessful&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpGet]
        [Route(&quot;IsValidAccountNumber&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse IsValidAccountNumber(long accountNumber)
        {
            try
            {
                bool isValid = _customerService.IsValidAccountNumber(accountNumber);
                if (isValid)
                    return new GenericResponse { Status = true, Data = isValid };
                return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:noAccountExists&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpGet]
        [Route(&quot;HasSufficientBalance&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse HasSufficientBalance(long accountNumber, double amount)
        {
            try
            {
                bool isSufficient = _customerService.HasSufficientBalance(accountNumber, amount);
                if (isSufficient) 
                    return new GenericResponse { Status = true, Data = isSufficient };
                return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:insufficientBalance&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpGet]
        [Route(&quot;IsExceedingMinBalanceWarningAmount&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse IsExceedingMinBalanceWarningAmount(long accountNumber, double amount)
        {
            try
            {
                bool isExceeding = _customerService.IsExceedingMinBalanceWarningAmount(accountNumber, amount);
                if(isExceeding)
                    return new GenericResponse { Status=true, Data = _configuration[&quot;GenericMessages:Values:exceedingMinBalance&quot;] };
                return new GenericResponse { Status = true, Data = isExceeding };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpGet]
        [Route(&quot;IsExceedingMaxBalanceWarningAmount&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse IsExceedingMaxBalanceWarningAmount(long accountNumber, double amount)
        {
            try
            {
                bool isExceeding = _customerService.IsExceedingMaxBalanceWarningAmount(accountNumber, amount);
                if (isExceeding) 
                    return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:exceedingMaxBalance&quot;] };
                return new GenericResponse { Status = true, Data= isExceeding };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpPost]
        [Route(&quot;TransferMoney&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse TransferMoney(TransactionsEntity transactionDetails)
        {
            try
            {
                _customerService.TransferMoney(transactionDetails);
                return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:moneyTransferSuccessful&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpPut]
        [Route(&quot;EditThresholdValue&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse EditThresholdValue(long accountNumber, Double minBalanceWarningAmount, Double maxBalanceWarningAmount)
        {
            try
            {
                _customerService.EditThresholdValue(accountNumber, minBalanceWarningAmount, maxBalanceWarningAmount); 
                return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:thresholdLimitSet&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpPut]
        [Route(&quot;FreezeWithdrawls&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse FreezeWithdrawls(long accountNumber)
        {
            try
            {
                _customerService.FreezeWithdrawls(accountNumber);
                return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:transactionFreezed&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpPut]
        [Route(&quot;UnFreezeWithdrawls&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse UnFreezeWithdrawls(long accountNumber)
        {
            try
            {
                _customerService.UnFreezeWithdrawls(accountNumber);
                return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:transactionUnFreezed&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpGet]
        [Route(&quot;GetAllTransactions&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse GetAllTransactions(long accountNumber)
        {
            try
            {
                List&lt;TransactionsEntity&gt; transactions = _customerService.GetAllTransactions(accountNumber);
                if (transactions.Count == 0)
                    return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:noTransactions&quot;] };
                return new GenericResponse { Status = true, Data =transactions };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[19,9,19,124,1],[20,9,20,10,1],[21,13,21,64,1],[22,13,22,44,1],[23,13,23,30,1],[24,9,24,10,1],[29,9,29,10,1],[31,13,31,14,1],[32,17,32,122,1],[33,17,33,86,1],[35,13,35,33,1],[36,13,36,14,1],[37,17,37,86,1],[38,17,38,105,1],[40,9,40,10,1],[45,9,45,10,1],[47,13,47,14,1],[48,17,48,128,1],[49,17,49,86,1],[51,13,51,33,1],[52,13,52,14,1],[53,17,53,46,1],[54,17,54,105,1],[56,9,56,10,1],[61,9,61,10,1],[63,13,63,14,1],[64,17,64,160,1],[65,17,65,86,1],[67,13,67,33,1],[68,13,68,14,1],[69,17,69,46,1],[70,17,70,105,1],[72,9,72,10,1],[77,9,77,10,1],[79,13,79,14,1],[80,17,80,65,1],[81,17,81,131,1],[83,13,83,33,1],[84,13,84,14,1],[85,17,85,46,1],[86,17,86,105,1],[88,9,88,10,1],[93,9,93,10,1],[95,13,95,14,1],[96,17,96,71,1],[97,17,97,131,1],[99,13,99,33,1],[100,13,100,14,1],[101,17,101,46,1],[102,17,102,105,1],[104,9,104,10,1],[109,9,109,10,1],[111,13,111,14,1],[112,17,112,103,1],[113,17,113,131,1],[115,13,115,33,1],[116,13,116,14,1],[117,17,117,46,1],[118,17,118,105,1],[120,9,120,10,1],[125,9,125,10,1],[127,13,127,14,1],[128,17,128,93,1],[129,17,129,79,1],[131,13,131,33,1],[132,13,132,14,1],[133,17,133,46,1],[134,17,134,105,1],[136,9,136,10,1],[141,9,141,10,1],[143,13,143,14,1],[144,17,144,75,1],[145,17,145,80,1],[147,13,147,33,1],[148,13,148,14,1],[149,17,149,46,1],[150,17,150,105,1],[152,9,152,10,1],[157,9,157,10,1],[159,13,159,14,1],[160,17,160,66,1],[161,17,161,123,1],[163,13,163,33,1],[164,13,164,14,1],[165,17,165,46,1],[166,17,166,105,1],[168,9,168,10,1],[173,9,173,10,1],[175,13,175,14,1],[176,17,176,67,1],[177,17,177,129,1],[179,13,179,33,1],[180,13,180,14,1],[181,17,181,46,1],[182,17,182,105,1],[184,9,184,10,1],[189,9,189,10,1],[191,13,191,14,1],[192,17,192,85,1],[193,17,193,29,1],[194,21,194,82,1],[195,17,195,127,1],[197,13,197,33,1],[198,13,198,14,1],[199,17,199,46,1],[200,17,200,105,1],[202,9,202,10,1],[207,9,207,10,1],[209,13,209,14,1],[210,17,210,98,1],[211,17,211,34,1],[212,21,212,87,1],[213,17,213,131,1],[215,13,215,33,1],[216,13,216,14,1],[217,17,217,46,1],[218,17,218,105,1],[220,9,220,10,1],[225,9,225,10,1],[227,13,227,14,1],[228,17,228,111,1],[229,17,229,32,1],[230,21,230,133,1],[231,17,231,82,1],[233,13,233,33,1],[234,13,234,14,1],[235,17,235,46,1],[236,17,236,105,1],[238,9,238,10,1],[243,9,243,10,1],[245,13,245,14,1],[246,17,246,111,1],[247,17,247,33,1],[248,21,248,135,1],[249,17,249,81,1],[251,13,251,33,1],[252,13,252,14,1],[253,17,253,46,1],[254,17,254,105,1],[256,9,256,10,1],[261,9,261,10,1],[263,13,263,14,1],[264,17,264,68,1],[265,17,265,135,1],[267,13,267,33,1],[268,13,268,14,1],[269,17,269,46,1],[270,17,270,105,1],[272,9,272,10,1],[277,9,277,10,1],[279,13,279,14,1],[280,17,280,118,1],[281,17,281,129,1],[283,13,283,33,1],[284,13,284,14,1],[285,17,285,46,1],[286,17,286,105,1],[288,9,288,10,1],[293,9,293,10,1],[295,13,295,14,1],[296,17,296,66,1],[297,17,297,130,1],[299,13,299,33,1],[300,13,300,14,1],[301,17,301,46,1],[302,17,302,105,1],[304,9,304,10,1],[309,9,309,10,1],[311,13,311,14,1],[312,17,312,68,1],[313,17,313,132,1],[315,13,315,33,1],[316,13,316,14,1],[317,17,317,46,1],[318,17,318,105,1],[320,9,320,10,1],[325,9,325,10,1],[327,13,327,14,1],[328,17,328,108,1],[329,17,329,45,1],[330,21,330,130,1],[331,17,331,82,1],[333,13,333,33,1],[334,13,334,14,1],[335,17,335,46,1],[336,17,336,105,1],[338,9,338,10,1]]);
    </script>
  </body>
</html>