<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\ENVAULT\Envault-Backend\UnitTesting\AccountOpeningTest\AccountOpeningControllerTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using ApplicationLayer.Interfaces;
using CoreModels;
using CoreModels.Entities;
using CoreModels.Models;
using Envault_Backend.Controllers;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.Logging;
using Moq;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace UnitTesting.AccountOpeningTest
{
    public class AccountOpeningControllerTest
    {
        private AccountOpeningController _accountOpeningController;
        private Mock&lt;IAccountOpeningRepository&gt; _accountOpeningRepository;
        private Mock&lt;IUnitOfWork&gt; _unitOfWork;
        private Mock&lt;IConfiguration&gt; _mockConfig;
        private Mock&lt;ILogger&lt;AccountOpeningController&gt;&gt; _logger;
        [OneTimeSetUp]
        public void SetUp()
        {

        }
        [SetUp]
        public void ReintializeTest()
        {
            _unitOfWork = new Mock&lt;IUnitOfWork&gt;();
            _mockConfig = new Mock&lt;Microsoft.Extensions.Configuration.IConfiguration&gt;();
            _logger = new Mock&lt;ILogger&lt;AccountOpeningController&gt;&gt;();

            var configSection = new Mock&lt;IConfigurationSection&gt;();
            configSection.Setup(a =&gt; a.GetSection(&quot;key&quot;).Value).Returns(&quot;Devika@123#$%^&amp;*&amp;^%$#$%^&amp;*&amp;^%$#%^&amp;*(*&amp;$#@#%^&amp;*&amp;^$#%^&amp;*&amp;^$#$%^&amp;*&amp;^%$#$%&amp;*&amp;^$#$%&amp;*&quot;);
            configSection.Setup(a =&gt; a.GetSection(&quot;Issuer&quot;).Value).Returns(&quot;Devika@12345&quot;);
            configSection.Setup(a =&gt; a.GetSection(&quot;Audience&quot;).Value).Returns(&quot;Devika@12345&quot;);
            _mockConfig.Setup(a =&gt; a.GetSection(&quot;Jwt&quot;)).Returns(configSection.Object);

            _accountOpeningController = new AccountOpeningController(_unitOfWork.Object, configSection.Object, _logger.Object);
            _accountOpeningRepository = new Mock&lt;IAccountOpeningRepository&gt;();
            _unitOfWork.Setup(a =&gt; a.AccountOpeningRepository).Returns(_accountOpeningRepository.Object);
        }
        [Test]
        [TestCase(12345678903456, 2345678698, &quot;2000-01-01&quot;)]
        public void CheckUserExistence_Exist(long aadharNumber, long mobileNumber, string dateOfBirthString)
        {
            DateOnly dateOfBirth = DateOnly.Parse(dateOfBirthString);
            _accountOpeningRepository.Setup(existence =&gt; existence.CheckUserExistence(aadharNumber, mobileNumber, dateOfBirth)).Returns(new BasicDetailsEntity());
            var response = _accountOpeningController.CheckUserExistence(aadharNumber, mobileNumber, dateOfBirth);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(12345678903456, 2345678698, &quot;2000-01-01&quot;)]
        public void CheckUserExistence_DoesNotExist(long aadharNumber, long mobileNumber, string dateOfBirthString)
        {
            DateOnly dateOfBirth = DateOnly.Parse(dateOfBirthString);
            _accountOpeningRepository.Setup(existence =&gt; existence.CheckUserExistence(aadharNumber, mobileNumber, dateOfBirth));
            var response = _accountOpeningController.CheckUserExistence(aadharNumber, mobileNumber, dateOfBirth);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(12345678903456, 2345678698, &quot;2000-01-01&quot;)]
        public void CheckUserExistence_Exception(long aadharNumber, long mobileNumber, string dateOfBirthString)
        {
            DateOnly dateOfBirth = DateOnly.Parse(dateOfBirthString);
            _accountOpeningRepository.Setup(existence =&gt; existence.CheckUserExistence(aadharNumber, mobileNumber, dateOfBirth)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _accountOpeningController.CheckUserExistence(aadharNumber, mobileNumber, dateOfBirth);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        [TestCase(&quot;abc@gmail.com&quot;)]
        public void IsUniqueEmail_Unique(string email)
        {
            _accountOpeningRepository.Setup(unique =&gt; unique.IsUniqueEmail(email)).Returns(true);
            var response = _accountOpeningController.IsUniqueEmail(email);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(&quot;abc@gmail.com&quot;)]
        public void IsUniqueEmail_NotUnique(string email)
        {
            _accountOpeningRepository.Setup(unique =&gt; unique.IsUniqueEmail(email)).Returns(false);
            var response = _accountOpeningController.IsUniqueEmail(email);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(&quot;abc@xyz&quot;)]
        public void IsUniqueEmail_Exception(string email)
        {
            _accountOpeningRepository.Setup(unique =&gt; unique.IsUniqueEmail(email)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _accountOpeningController.IsUniqueEmail(email);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        [TestCase(&quot;MKTGH0098H&quot;)]
        public void IsUniquePANNumber_Unique (string panNumber)
        {
            _accountOpeningRepository.Setup(unique =&gt; unique.IsUniquePANNumber(panNumber)).Returns(true);
            var response = _accountOpeningController.IsUniquePANNumber(panNumber);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(&quot;MKTGH0098H&quot;)]
        public void IsUniquePANNumber_NotUnique(string panNumber)
        {
            _accountOpeningRepository.Setup(unique =&gt; unique.IsUniquePANNumber(panNumber)).Returns(false);
            var response = _accountOpeningController.IsUniquePANNumber(panNumber);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(&quot;MKTGH0098H&quot;)]
        public void IsUniquePANNumber_Exception(string panNumber)
        {
            _accountOpeningRepository.Setup(unique =&gt; unique.IsUniquePANNumber(panNumber)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _accountOpeningController.IsUniquePANNumber(panNumber);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        public void GetAllBranches()
        {
            _accountOpeningRepository.Setup(branch =&gt; branch.GetAllBranches()).Returns([new BranchDetails()]);
            var response = _accountOpeningController.GetAllBranches();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        public void GetAllBranches_NoBranches()
        {
            _accountOpeningRepository.Setup(branch =&gt; branch.GetAllBranches()).Returns([]);
            var response = _accountOpeningController.GetAllBranches();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        public void GetAllBranches_Exception()
        {
            _accountOpeningRepository.Setup(branch =&gt; branch.GetAllBranches()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _accountOpeningController.GetAllBranches();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        public void CreateNewAccount()
        {
            var basicDetails = new BasicDetailsEntity
            {
                CustomerName = &quot;Vani&quot;,
                DateOfBirth = DateOnly.Parse(&quot;2003-06-02&quot;),
                Gender = &quot;Female&quot;,
                AadharNumber = 1234567893456,
                MobileNumber = 98765432085,
                PANNumber = &quot;MNHJT2345L&quot;,
                CustomerEmail = &quot;abc@gmail.com&quot;,
                EmployementType = &quot;Private Sector&quot;,
                AnnualIncome = 9876543,
                Nationality = true,
                TaxResidentOfIndia = true
            };
            _accountOpeningRepository.Setup(account =&gt; account.CreateNewAccount(basicDetails)).Returns(new {});
            var response = _accountOpeningController.CreateNewAccount(basicDetails);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        public void CreateNewAccount_Fail()
        {
            var basicDetails = new BasicDetailsEntity
            {
                CustomerName = &quot;Vani&quot;,
                DateOfBirth = DateOnly.Parse(&quot;2003-06-02&quot;),
                Gender = &quot;Female&quot;,
                AadharNumber = 1234567893456,
                MobileNumber = 98765432085,
                PANNumber = &quot;MNHJT2345L&quot;,
                CustomerEmail = &quot;abc@gmail.com&quot;,
                EmployementType = &quot;Private Sector&quot;,
                AnnualIncome = 9876543,
                Nationality = true,
                TaxResidentOfIndia = true
            };
            _accountOpeningRepository.Setup(account =&gt; account.CreateNewAccount(basicDetails)).Returns(null);
            var response = _accountOpeningController.CreateNewAccount(basicDetails);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        public void CreateNewAccount_Exception()
        {
            var basicDetails = new BasicDetailsEntity
            {
                CustomerName = &quot;Vani&quot;,
                DateOfBirth = DateOnly.Parse(&quot;2003-06-02&quot;),
                Gender = &quot;Female&quot;,
                AadharNumber = 1234567893456,
                MobileNumber = 98765432085,
                PANNumber = &quot;MNHJT2345L&quot;,
                CustomerEmail = &quot;abc@gmail.com&quot;,
                EmployementType = &quot;Private Sector&quot;,
                AnnualIncome = 9876543,
                Nationality = true,
                TaxResidentOfIndia = true
            };
            _accountOpeningRepository.Setup(account =&gt; account.CreateNewAccount(basicDetails)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _accountOpeningController.CreateNewAccount(basicDetails);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        public void CreateAnotherAccount()
        {
            var account = new AccountsEntity()
            {
                AccountTypeId = 1
            };
            _accountOpeningRepository.Setup(customer =&gt; customer.CreateAnotherAccount(account)).Returns(new {});
            var response = _accountOpeningController.CreateAnotherAccount(account);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        public void CreateAnotherAccount_Fail()
        {
            var account = new AccountsEntity()
            {
                AccountTypeId = 1
            };
            _accountOpeningRepository.Setup(customer =&gt; customer.CreateAnotherAccount(account));
            var response = _accountOpeningController.CreateAnotherAccount(account);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        public void CreateAnotherAccount_Exception()
        {
            var account = new AccountsEntity()
            {
                AccountTypeId = 1
            };
            _accountOpeningRepository.Setup(customer =&gt; customer.CreateAnotherAccount(account)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _accountOpeningController.CreateAnotherAccount(account);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[26,9,26,10,1],[28,9,28,10,1],[31,9,31,10,1],[32,13,32,51,1],[33,13,33,89,1],[34,13,34,69,1],[36,13,36,67,1],[37,13,37,157,1],[38,13,38,92,1],[39,13,39,94,1],[40,13,40,87,1],[42,13,42,128,1],[43,13,43,79,1],[44,13,44,106,1],[45,9,45,10,1],[49,9,49,10,1],[50,13,50,70,1],[51,13,51,163,1],[52,13,52,114,1],[53,13,53,75,1],[54,13,54,58,1],[55,9,55,10,1],[59,9,59,10,1],[60,13,60,70,1],[61,13,61,129,1],[62,13,62,114,1],[63,13,63,75,1],[64,13,64,58,1],[65,9,65,10,1],[69,9,69,10,1],[70,13,70,70,1],[71,13,71,175,1],[72,13,72,114,1],[73,13,73,75,1],[74,13,74,59,1],[75,9,75,10,1],[79,9,79,10,1],[80,13,80,98,1],[81,13,81,75,1],[82,13,82,75,1],[83,13,83,58,1],[84,9,84,10,1],[88,9,88,10,1],[89,13,89,99,1],[90,13,90,75,1],[91,13,91,75,1],[92,13,92,58,1],[93,9,93,10,1],[97,9,97,10,1],[98,13,98,130,1],[99,13,99,75,1],[100,13,100,75,1],[101,13,101,59,1],[102,9,102,10,1],[106,9,106,10,1],[107,13,107,106,1],[108,13,108,83,1],[109,13,109,75,1],[110,13,110,58,1],[111,9,111,10,1],[115,9,115,10,1],[116,13,116,107,1],[117,13,117,83,1],[118,13,118,75,1],[119,13,119,58,1],[120,9,120,10,1],[124,9,124,10,1],[125,13,125,138,1],[126,13,126,83,1],[127,13,127,75,1],[128,13,128,59,1],[129,9,129,10,1],[132,9,132,10,1],[133,13,133,111,1],[134,13,134,71,1],[135,13,135,75,1],[136,13,136,58,1],[137,9,137,10,1],[140,9,140,10,1],[141,13,141,92,1],[142,13,142,71,1],[143,13,143,75,1],[144,13,144,58,1],[145,9,145,10,1],[148,9,148,10,1],[149,13,149,126,1],[150,13,150,71,1],[151,13,151,75,1],[152,13,152,59,1],[153,9,153,10,1],[156,9,156,10,1],[157,13,170,15,1],[171,13,171,112,1],[172,13,172,85,1],[173,13,173,75,1],[174,13,174,58,1],[175,9,175,10,1],[178,9,178,10,1],[179,13,192,15,1],[193,13,193,110,1],[194,13,194,85,1],[195,13,195,75,1],[196,13,196,58,1],[197,9,197,10,1],[200,9,200,10,1],[201,13,214,15,1],[215,13,215,142,1],[216,13,216,85,1],[217,13,217,75,1],[218,13,218,59,1],[219,9,219,10,1],[222,9,222,10,1],[223,13,226,15,1],[227,13,227,113,1],[228,13,228,84,1],[229,13,229,75,1],[230,13,230,58,1],[231,9,231,10,1],[234,9,234,10,1],[235,13,238,15,1],[239,13,239,97,1],[240,13,240,84,1],[241,13,241,75,1],[242,13,242,58,1],[243,9,243,10,1],[246,9,246,10,1],[247,13,250,15,1],[251,13,251,143,1],[252,13,252,84,1],[253,13,253,75,1],[254,13,254,59,1],[255,9,255,10,1]]);
    </script>
  </body>
</html>