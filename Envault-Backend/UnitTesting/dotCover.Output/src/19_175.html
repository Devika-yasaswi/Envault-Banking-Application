<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\ENVAULT\Envault-Backend\Envault-Backend\Controllers\CustomerController.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using ApplicationLayer.Interfaces;
using BusinessLogicLayer;
using CoreModels;
using CoreModels.Entities;
using CoreModels.Models;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;

namespace Envault_Backend.Controllers
{
    [Route(&quot;api/[controller]&quot;)]
    [ApiController]
    public class CustomerController : ControllerBase
    {
        private readonly CustomerService _customerService;
        private readonly IConfiguration _configuration;
        private readonly ILogger&lt;CustomerController&gt; _logger;
        public CustomerController(IUnitOfWork unitOfWork, IConfiguration configuration, ILogger&lt;CustomerController&gt; logger)
        {
            _customerService = new CustomerService(unitOfWork);
            _configuration = configuration;
            _logger = logger;
        }
        [HttpGet]
        [Route(&quot;GetBasicDetails&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public async Task&lt;GenericResponse&gt; GetBasicDetails(long customerId)
        {
            try
            {
                BasicDetailsEntity customerDetails = await Task.FromResult(_customerService.GetBasicDetails(customerId));
                return new GenericResponse { Status = true, Data = customerDetails };
            }
            catch (Exception ex)
            {
                _logger.LogError(&quot;Error while retriving basic details&quot; + ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpGet]
        [Route(&quot;GetCustomerAddress&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public async Task&lt;GenericResponse&gt; GetCustomerAddress(long customerId)
        {
            try
            {
                CustomerAddressEntity customerDetails = await Task.FromResult(_customerService.GetCustomerAddress(customerId));
                return new GenericResponse { Status = true, Data = customerDetails };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpGet]
        [Route(&quot;GetCustomerFamilyAndNomineeDetails&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public async Task&lt;GenericResponse&gt; GetCustomerFamilyAndNomineeDetails(long customerId)
        {
            try
            {
                CustomerFamilyAndNomineeDetailsEntity customerDetails = await Task.FromResult(_customerService.GetCustomerFamilyAndNomineeDetails(customerId));
                return new GenericResponse { Status = true, Data = customerDetails };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpPost]
        [Route(&quot;EditBasicDetails&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse EditBasicDetails(BasicDetailsEntity basicDetails)
        {
            try
            {
                _customerService.EditBasicDetails(basicDetails);
                return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:dataUpdationSuccess&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpPost]
        [Route(&quot;EditCustomerAddress&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse EditCustomerAddress(CustomerAddressEntity customerAddress)
        {
            try
            {
                _customerService.EditCustomerAddress(customerAddress);
                return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:dataUpdationSuccess&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpPost]
        [Route(&quot;EditCustomerFamilyAndNomineeDetails&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse EditCustomerFamilyAndNomineeDetails(CustomerFamilyAndNomineeDetailsEntity customerFamilyAndNomineeDetails)
        {
            try
            {
                _customerService.EditCustomerFamilyAndNomineeDetails(customerFamilyAndNomineeDetails);
                return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:dataUpdationSuccess&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpGet]
        [Route(&quot;GetAllAccounts&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse GetAllAccounts(long customerId)
        {
            try
            {
                List&lt;AccountDetails&gt; accounts = _customerService.GetAllAccounts(customerId);
                return new GenericResponse { Status = true, Data = accounts };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpGet]
        [Route(&quot;KYCStatus&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse KYCStatus(long customerId)
        {
            try
            {
                string kycStatus = _customerService.KYCStatus(customerId);
                return new GenericResponse { Status = true, Data = kycStatus };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpPost]
        [Route(&quot;CompleteKYC&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse CompleteKYC(KYCModel customerKYCDetails)
        {
            try
            {
                _customerService.CompleteKYC(customerKYCDetails);
                return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:kycUploaded&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpPost]
        [Route(&quot;DepositMoney&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse DepositMoney(TransactionsEntity transactionDetails)
        {
            try
            {
                _customerService.DepositMoney(transactionDetails);
                return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:depositSuccessful&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpGet]
        [Route(&quot;IsValidAccountNumber&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse IsValidAccountNumber(long accountNumber)
        {
            try
            {
                bool isValid = _customerService.IsValidAccountNumber(accountNumber);
                if (isValid)
                    return new GenericResponse { Status = true, Data = isValid };
                return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:noAccountExists&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpGet]
        [Route(&quot;HasSufficientBalance&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse HasSufficientBalance(long accountNumber, double amount)
        {
            try
            {
                bool isSufficient = _customerService.HasSufficientBalance(accountNumber, amount);
                if (isSufficient) 
                    return new GenericResponse { Status = true, Data = isSufficient };
                return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:insufficientBalance&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpGet]
        [Route(&quot;IsExceedingMinBalanceWarningAmount&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse IsExceedingMinBalanceWarningAmount(long accountNumber, long amount)
        {
            try
            {
                bool isExceeding = _customerService.IsExceedingMinBalanceWarningAmount(accountNumber, amount);
                if(isExceeding)
                    return new GenericResponse { Status=true, Data = _configuration[&quot;GenericMessages:Values:exceedingMinBalance&quot;] };
                return new GenericResponse { Status = true, Data = isExceeding };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpGet]
        [Route(&quot;IsExceedingMaxBalanceWarningAmount&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse IsExceedingMaxBalanceWarningAmount(long accountNumber, long amount)
        {
            try
            {
                bool isExceeding = _customerService.IsExceedingMaxBalanceWarningAmount(accountNumber, amount);
                if (isExceeding) 
                    return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:exceedingMaxBalance&quot;] };
                return new GenericResponse { Status = true, Data= isExceeding };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpPost]
        [Route(&quot;TransferMoney&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse TransferMoney(TransactionsEntity transactionDetails)
        {
            try
            {
                _customerService.TransferMoney(transactionDetails);
                return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:moneyTransferSuccessful&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpPut]
        [Route(&quot;EditThresholdValue&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse EditThresholdValue(long accountNumber, Double minBalanceWarningAmount, Double maxBalanceWarningAmount)
        {
            try
            {
                _customerService.EditThresholdValue(accountNumber, minBalanceWarningAmount, maxBalanceWarningAmount); 
                return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:thresholdLimitSet&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpPut]
        [Route(&quot;FreezeWithdrawls&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse FreezeWithdrawls(long accountNumber)
        {
            try
            {
                _customerService.FreezeWithdrawls(accountNumber);
                return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:transactionFreezed&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpPut]
        [Route(&quot;UnFreezeWithdrawls&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse UnFreezeWithdrawls(long accountNumber)
        {
            try
            {
                _customerService.UnFreezeWithdrawls(accountNumber);
                return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:transactionUnFreezed&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpGet]
        [Route(&quot;GetAllTransactions&quot;)]
        [Authorize(Roles = &quot;Customer&quot;)]
        public GenericResponse GetAllTransactions(long accountNumber)
        {
            try
            {
                List&lt;TransactionsEntity&gt; transactions = _customerService.GetAllTransactions(accountNumber);
                if (transactions.Count == 0)
                    return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:noTransactions&quot;] };
                return new GenericResponse { Status = true, Data =transactions };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[19,9,19,124,0],[20,9,20,10,0],[21,13,21,64,0],[22,13,22,44,0],[23,13,23,30,0],[24,9,24,10,0],[29,9,29,10,0],[31,13,31,14,0],[32,17,32,122,0],[33,17,33,86,0],[35,13,35,33,0],[36,13,36,14,0],[37,17,37,86,0],[38,17,38,105,0],[40,9,40,10,0],[45,9,45,10,0],[47,13,47,14,0],[48,17,48,128,0],[49,17,49,86,0],[51,13,51,33,0],[52,13,52,14,0],[53,17,53,46,0],[54,17,54,105,0],[56,9,56,10,0],[61,9,61,10,0],[63,13,63,14,0],[64,17,64,160,0],[65,17,65,86,0],[67,13,67,33,0],[68,13,68,14,0],[69,17,69,46,0],[70,17,70,105,0],[72,9,72,10,0],[77,9,77,10,0],[79,13,79,14,0],[80,17,80,65,0],[81,17,81,131,0],[83,13,83,33,0],[84,13,84,14,0],[85,17,85,46,0],[86,17,86,105,0],[88,9,88,10,0],[93,9,93,10,0],[95,13,95,14,0],[96,17,96,71,0],[97,17,97,131,0],[99,13,99,33,0],[100,13,100,14,0],[101,17,101,46,0],[102,17,102,105,0],[104,9,104,10,0],[109,9,109,10,0],[111,13,111,14,0],[112,17,112,103,0],[113,17,113,131,0],[115,13,115,33,0],[116,13,116,14,0],[117,17,117,46,0],[118,17,118,105,0],[120,9,120,10,0],[125,9,125,10,0],[127,13,127,14,0],[128,17,128,93,0],[129,17,129,79,0],[131,13,131,33,0],[132,13,132,14,0],[133,17,133,46,0],[134,17,134,105,0],[136,9,136,10,0],[141,9,141,10,0],[143,13,143,14,0],[144,17,144,75,0],[145,17,145,80,0],[147,13,147,33,0],[148,13,148,14,0],[149,17,149,46,0],[150,17,150,105,0],[152,9,152,10,0],[157,9,157,10,0],[159,13,159,14,0],[160,17,160,66,0],[161,17,161,123,0],[163,13,163,33,0],[164,13,164,14,0],[165,17,165,46,0],[166,17,166,105,0],[168,9,168,10,0],[173,9,173,10,0],[175,13,175,14,0],[176,17,176,67,0],[177,17,177,129,0],[179,13,179,33,0],[180,13,180,14,0],[181,17,181,46,0],[182,17,182,105,0],[184,9,184,10,0],[189,9,189,10,0],[191,13,191,14,0],[192,17,192,85,0],[193,17,193,29,0],[194,21,194,82,0],[195,17,195,127,0],[197,13,197,33,0],[198,13,198,14,0],[199,17,199,46,0],[200,17,200,105,0],[202,9,202,10,0],[207,9,207,10,0],[209,13,209,14,0],[210,17,210,98,0],[211,17,211,34,0],[212,21,212,87,0],[213,17,213,131,0],[215,13,215,33,0],[216,13,216,14,0],[217,17,217,46,0],[218,17,218,105,0],[220,9,220,10,0],[225,9,225,10,0],[227,13,227,14,0],[228,17,228,111,0],[229,17,229,32,0],[230,21,230,133,0],[231,17,231,82,0],[233,13,233,33,0],[234,13,234,14,0],[235,17,235,46,0],[236,17,236,105,0],[238,9,238,10,0],[243,9,243,10,0],[245,13,245,14,0],[246,17,246,111,0],[247,17,247,33,0],[248,21,248,135,0],[249,17,249,81,0],[251,13,251,33,0],[252,13,252,14,0],[253,17,253,46,0],[254,17,254,105,0],[256,9,256,10,0],[261,9,261,10,0],[263,13,263,14,0],[264,17,264,68,0],[265,17,265,135,0],[267,13,267,33,0],[268,13,268,14,0],[269,17,269,46,0],[270,17,270,105,0],[272,9,272,10,0],[277,9,277,10,0],[279,13,279,14,0],[280,17,280,118,0],[281,17,281,129,0],[283,13,283,33,0],[284,13,284,14,0],[285,17,285,46,0],[286,17,286,105,0],[288,9,288,10,0],[293,9,293,10,0],[295,13,295,14,0],[296,17,296,66,0],[297,17,297,130,0],[299,13,299,33,0],[300,13,300,14,0],[301,17,301,46,0],[302,17,302,105,0],[304,9,304,10,0],[309,9,309,10,0],[311,13,311,14,0],[312,17,312,68,0],[313,17,313,132,0],[315,13,315,33,0],[316,13,316,14,0],[317,17,317,46,0],[318,17,318,105,0],[320,9,320,10,0],[325,9,325,10,0],[327,13,327,14,0],[328,17,328,108,0],[329,17,329,45,0],[330,21,330,130,0],[331,17,331,82,0],[333,13,333,33,0],[334,13,334,14,0],[335,17,335,46,0],[336,17,336,105,0],[338,9,338,10,0]]);
    </script>
  </body>
</html>