<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\ENVAULT\Envault-Backend\UnitTesting\CustomerTest\CustomerRepositoryTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Azure;
using Castle.Core.Resource;
using CoreModels.Entities;
using CoreModels.Models;
using Microsoft.EntityFrameworkCore;
using Moq;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using UnitTesting.Utils;

namespace UnitTesting.CustomerTest
{
    public class CustomerRepositoryTest : DbContextMock
    {
        [Test]
        [TestCase(10000001)]
        public void GetBasicDetails(long customerId)
        {
            var response = _customerRepository.GetBasicDetails(customerId);
            Assert.IsNotNull(response);
            Assert.That(response.CustomerId, Is.EqualTo(customerId));
        }
        [Test]
        public void GetBasicDetails_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;BasicDetailsEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _customerRepository.GetBasicDetails(0));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        [TestCase(10000001)]
        public void GetCustomerAddress(long customerId)
        {
            var response = _customerRepository.GetCustomerAddress(customerId);
            Assert.That(response, Is.Not.Null);
            Assert.That(response.CustomerId, Is.EqualTo(customerId));
        }
        [Test]
        public void GetCustomerAddress_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;CustomerAddressEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _customerRepository.GetCustomerAddress(0));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        [TestCase(10000001)]
        public void GetCustomerFamilyAndNomineeDetails(long customerId)
        {
            var response = _customerRepository.GetCustomerFamilyAndNomineeDetails(customerId);
            Assert.IsNotNull(response);
            Assert.That(response.CustomerId, Is.EqualTo(customerId));
        }
        [Test]
        public void GetCustomerFamilyAndNomineeDetails_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;CustomerFamilyAndNomineeDetailsEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _customerRepository.GetCustomerFamilyAndNomineeDetails(0));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        public void EditBasicDetails()
        {
            BasicDetailsEntity customerDetails = new BasicDetailsEntity()
            {
                CustomerId = 10000001,
                CustomerName = &quot;Sri Ram&quot;,
                DateOfBirth = DateOnly.Parse(&quot;1978-01-01&quot;),
                Gender = &quot;Male&quot;,
                AadharNumber = 981234567890,
                MobileNumber = 9876543210,
                PANNumber = &quot;MKTPK0515M&quot;,
                CustomerEmail = &quot;sriram@gmail.com&quot;,
                EmployementType = &quot;Public Sector&quot;,
                AnnualIncome = 99999,
                Nationality = true,
                TaxResidentOfIndia = true
            };
            _customerRepository.EditBasicDetails(customerDetails);
            _mockContext.Verify(m =&gt; m.SaveChanges(), Times.Once);
        }
        [Test]
        public void EditBasicDetails_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;BasicDetailsEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _customerRepository.EditBasicDetails(new BasicDetailsEntity()));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        public void EditCustomerAddress()
        {
            var customerAddress = new CustomerAddressEntity
            {
                CustomerId = 10000001,
                PermanentHouseNo = &quot;2/89&quot;,
                PermanentStreet = &quot;Vidyanagar 1st line&quot;,
                PermanentCity = &quot;Singarayakonda&quot;,
                PermanentState = &quot;Andhra Pradesh&quot;,
                PermanentPincode = 123456,
                PresentHouseNo = &quot;2/89&quot;,
                PresentStreet = &quot;Vidyanagar 1st line&quot;,
                PresentCity = &quot;Singarayakonda&quot;,
                PresentState = &quot;Andhra Pradesh&quot;,
                PresentPincode = 123456
            };
            _customerRepository.EditCustomerAddress(customerAddress);
            _mockContext.Verify(m =&gt; m.SaveChanges(), Times.Once);
        }
        [Test]
        public void EditCustomerAddress_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;CustomerAddressEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _customerRepository.EditCustomerAddress(new CustomerAddressEntity()));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        public void EditCustomerFamilyAndNomineeDetails()
        {
            var customerFamilyAndNominee = new CustomerFamilyAndNomineeDetailsEntity()
            {
                CustomerId = 10000001,
                FatherName = &quot;Dasaradh&quot;,
                MotherName = &quot;Kousalya&quot;,
                SpouseName = &quot;Seetha&quot;,
                NomineeName = &quot;Dasaradh&quot;,
                NomineeDateOfBirth = DateOnly.Parse(&quot;1947-08-15&quot;),
                RelationWithNominee = &quot;Father&quot;,
                NomineeHouseNo = &quot;3-25&quot;,
                NomineeStreet = &quot;Vidyanagar 7th line&quot;,
                NomineeCity = &quot;Singarayakonda&quot;,
                NomineeState = &quot;Andhra Pradesh&quot;,
                NomineePincode = 123456
            };
            _customerRepository.EditCustomerFamilyAndNomineeDetails(customerFamilyAndNominee);
            _mockContext.Verify(m =&gt; m.SaveChanges(), Times.Once);
        }
        [Test]
        public void EditCustomerFamilyAndNomineeDetails_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;CustomerFamilyAndNomineeDetailsEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _customerRepository.EditCustomerFamilyAndNomineeDetails(new CustomerFamilyAndNomineeDetailsEntity()));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        [TestCase(10000001)]
        public void GetAllAccounts(long customerId)
        {
            var response = _customerRepository.GetAllAccounts(10000001);
            Assert.That(response, Is.Not.Null);
        }
        [Test]
        public void GetAllAccounts_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;AccountsEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _customerRepository.GetAllAccounts(0));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        [TestCase(10000001)]
        [TestCase(10000000)]
        public void KYCStatus(long customerId)
        {
            var response = _customerRepository.KYCStatus(customerId);
            if (customerId == 10000001)
                Assert.That(response, Is.Not.Null);
            else if (customerId == 10000000)
                Assert.That(response, Is.Null);
        }
        [Test]
        public void KYCStatus_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;KYCEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _customerRepository.KYCStatus(0));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        [TestCase(10000003, &quot;base64,QUI=&quot;, &quot;base64,eHl6&quot;, &quot;base64,a2xt&quot;)]
        [TestCase(10000004, &quot;base64,Z2Vo&quot;, &quot;base64,ams=&quot;, &quot;base64,b2Vw&quot;)]
        public void CompleteKYC(long customerId, string aadharCard, string panCard, string customerPhoto)
        {
            var customerKYC = new KYCModel()
            {
                CustomerId = customerId,
                AadharCard = aadharCard,
                PANCard = panCard,
                CustomerPhoto = customerPhoto
            };
            _customerRepository.CompleteKYC(customerKYC);
            _mockContext.Verify(m =&gt; m.SaveChanges(), Times.Once);

        }
        [Test]
        public void CompleteKYC_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;KYCEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _customerRepository.CompleteKYC(new KYCModel()));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        public void DepositMoney()
        {
            var transactiondetails = new TransactionsEntity()
            {
                TransactionID = 1000003,
                SenderAccountNumber = 100000000001,
                ReceiverAccountNumber = 100000000001,
                Amount = 1,
                TransactionTime = DateTime.Now
            };
            _customerRepository.DepositMoney(transactiondetails);
            _mockContext.Verify(m =&gt; m.SaveChanges(), Times.Once);
        }
        [Test]
        public void DepositMoney_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;AccountsEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _customerRepository.DepositMoney(new TransactionsEntity()));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        [TestCase(100000000001)]
        [TestCase(100000000000)]
        public void IsValidAccountNumber(long accountNumber)
        {
            var response = _customerRepository.IsValidAccountNumber(accountNumber);
            if (accountNumber == 100000000001)
                Assert.That(response, Is.True);
            else if (accountNumber == 100000000000)
                Assert.That(response, Is.False);
        }
        [Test]
        public void IsValidAccountNumber_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;AccountsEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _customerRepository.IsValidAccountNumber(0));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        [TestCase(100000000002, 100)]
        [TestCase(100000000001, 10)]
        public void HasSufficientBalance(long accountNumber, double amount)
        {
            var response = _customerRepository.HasSufficientBalance(accountNumber, amount);
            if (accountNumber == 100000000002)
                Assert.That(response, Is.True);
            else if (accountNumber == 100000000001)
                Assert.That(response, Is.False);
        }
        [Test]
        public void HasSufficientBalance_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;AccountsEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _customerRepository.HasSufficientBalance(0, 0));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        [TestCase(100000000002, 100)]
        [TestCase(100000000001, 10)]
        public void IsExceedingMinBalanceWarningAmount(long accountNumber, double amount)
        {
            var response = _customerRepository.IsExceedingMinBalanceWarningAmount(accountNumber, amount);
            if (accountNumber == 100000000001)
                Assert.That(response, Is.True);
            else if (accountNumber == 100000000002)
                Assert.That(response, Is.False);
        }
        [Test]
        public void IsExceedingMinBalanceWarningAmount_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;AccountsEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _customerRepository.IsExceedingMinBalanceWarningAmount(0, 0));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        [TestCase(100000000001, 1500)]
        [TestCase(100000000002, 100)]
        public void IsExceedingMaxBalanceWarningAmount(long accountNumber, double amount)
        {
            var response = _customerRepository.IsExceedingMaxBalanceWarningAmount(accountNumber, amount);
            if (accountNumber == 100000000001)
                Assert.That(response, Is.True);
            else if (accountNumber == 100000000002)
                Assert.That(response, Is.False);
        }
        [Test]
        public void IsExceedingMaxBalanceWarningAmount_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;AccountsEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _customerRepository.IsExceedingMaxBalanceWarningAmount(0, 0));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        public void TransferMoney()
        {
            var transactionDetails = new TransactionsEntity()
            {
                TransactionID = 1000001,
                SenderAccountNumber = 100000000001,
                ReceiverAccountNumber = 100000000002,
                Amount = 1000,
                TransactionTime = DateTime.Now,
                Remarks = &quot;Transferring to my self account&quot;
            };
            _customerRepository.TransferMoney(transactionDetails);
            _mockContext.Verify(m =&gt; m.SaveChanges(), Times.Once);
        }
        [Test]
        public void TransferMoney_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;AccountsEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _customerRepository.TransferMoney(new TransactionsEntity()));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        [TestCase(100000000001, 100,1000)]
        public void EditThresholdValue(long accountNumber, double minBalanceWarningAmount, double maxBalanceWarningAmount)
        {
            _customerRepository.EditThresholdValue(accountNumber, minBalanceWarningAmount, maxBalanceWarningAmount);
            _mockContext.Verify(m =&gt; m.SaveChanges(), Times.Once);
        }
        [Test]
        public void EditThresholdValue_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;AccountsEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _customerRepository.EditThresholdValue(0,0,0));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        public void FreezeWithdrawls()
        {
            _customerRepository.FreezeWithdrawls(100000000001);
            _mockContext.Verify(m =&gt; m.SaveChanges(), Times.Once);
        }
        [Test]
        public void FreezeWithdrawls_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;AccountsEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _customerRepository.FreezeWithdrawls(0));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        public void UnFreezeWithdrawls()
        {
            _customerRepository.UnFreezeWithdrawls(100000000001);
            _mockContext.Verify(m =&gt; m.SaveChanges(), Times.Once);
        }
        [Test]
        public void UnFreezeWithdrawls_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;AccountsEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _customerRepository.UnFreezeWithdrawls(0));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        public void GetAllTransactions()
        {
            var response = _customerRepository.GetAllTransactions(100000000001);
            Assert.That(response, Is.Not.Null);
        }
        [Test]
        public void GetAllTransactions_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;TransactionsEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _customerRepository.GetAllTransactions(0));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[21,9,21,10,1],[22,13,22,76,1],[23,13,23,40,1],[24,13,24,70,1],[25,9,25,10,1],[28,9,28,10,1],[29,13,29,112,1],[30,13,30,59,1],[30,59,30,97,1],[30,97,30,99,1],[31,13,31,79,1],[32,9,32,10,1],[36,9,36,10,1],[37,13,37,79,1],[38,13,38,48,1],[39,13,39,70,1],[40,9,40,10,1],[43,9,43,10,1],[44,13,44,115,1],[45,13,45,59,1],[45,59,45,100,1],[45,100,45,102,1],[46,13,46,79,1],[47,9,47,10,1],[51,9,51,10,1],[52,13,52,95,1],[53,13,53,40,1],[54,13,54,70,1],[55,9,55,10,1],[58,9,58,10,1],[59,13,59,131,1],[60,13,60,59,1],[60,59,60,116,1],[60,116,60,118,1],[61,13,61,79,1],[62,9,62,10,1],[65,9,65,10,1],[66,13,80,15,1],[81,13,81,67,1],[82,13,82,67,1],[83,9,83,10,1],[86,9,86,10,1],[87,13,87,112,1],[88,13,88,59,1],[88,59,88,121,1],[88,121,88,123,1],[89,13,89,79,1],[90,9,90,10,1],[93,9,93,10,1],[94,13,107,15,1],[108,13,108,70,1],[109,13,109,67,1],[110,9,110,10,1],[113,9,113,10,1],[114,13,114,115,1],[115,13,115,59,1],[115,59,115,127,1],[115,127,115,129,1],[116,13,116,79,1],[117,9,117,10,1],[120,9,120,10,1],[121,13,135,15,1],[136,13,136,95,1],[137,13,137,67,1],[138,9,138,10,1],[141,9,141,10,1],[142,13,142,131,1],[143,13,143,59,1],[143,59,143,159,1],[143,159,143,161,1],[144,13,144,79,1],[145,9,145,10,1],[149,9,149,10,1],[150,13,150,73,1],[151,13,151,48,1],[152,9,152,10,1],[155,9,155,10,1],[156,13,156,108,1],[157,13,157,59,1],[157,59,157,96,1],[157,96,157,98,1],[158,13,158,79,1],[159,9,159,10,1],[164,9,164,10,1],[165,13,165,70,1],[166,13,166,40,1],[167,17,167,52,1],[168,18,168,45,1],[169,17,169,48,1],[170,9,170,10,1],[173,9,173,10,1],[174,13,174,103,1],[175,13,175,59,1],[175,59,175,91,1],[175,91,175,93,1],[176,13,176,79,1],[177,9,177,10,1],[182,9,182,10,1],[183,13,189,15,1],[190,13,190,58,1],[191,13,191,67,1],[193,9,193,10,1],[196,9,196,10,1],[197,13,197,103,1],[198,13,198,59,1],[198,59,198,106,1],[198,106,198,108,1],[199,13,199,79,1],[200,9,200,10,1],[203,9,203,10,1],[204,13,211,15,1],[212,13,212,66,1],[213,13,213,67,1],[214,9,214,10,1],[217,9,217,10,1],[218,13,218,108,1],[219,13,219,59,1],[219,59,219,117,1],[219,117,219,119,1],[220,13,220,79,1],[221,9,221,10,1],[226,9,226,10,1],[227,13,227,84,1],[228,13,228,47,1],[229,17,229,48,1],[230,18,230,52,1],[231,17,231,49,1],[232,9,232,10,1],[235,9,235,10,1],[236,13,236,108,1],[237,13,237,59,1],[237,59,237,102,1],[237,102,237,104,1],[238,13,238,79,1],[239,9,239,10,1],[244,9,244,10,1],[245,13,245,92,1],[246,13,246,47,1],[247,17,247,48,1],[248,18,248,52,1],[249,17,249,49,1],[250,9,250,10,1],[253,9,253,10,1],[254,13,254,108,1],[255,13,255,59,1],[255,59,255,105,1],[255,105,255,107,1],[256,13,256,79,1],[257,9,257,10,1],[262,9,262,10,1],[263,13,263,106,1],[264,13,264,47,1],[265,17,265,48,1],[266,18,266,52,1],[267,17,267,49,1],[268,9,268,10,1],[271,9,271,10,1],[272,13,272,108,1],[273,13,273,59,1],[273,59,273,119,1],[273,119,273,121,1],[274,13,274,79,1],[275,9,275,10,1],[280,9,280,10,1],[281,13,281,106,1],[282,13,282,47,1],[283,17,283,48,1],[284,18,284,52,1],[285,17,285,49,1],[286,9,286,10,1],[289,9,289,10,1],[290,13,290,108,1],[291,13,291,59,1],[291,59,291,119,1],[291,119,291,121,1],[292,13,292,79,1],[293,9,293,10,1],[296,9,296,10,1],[297,13,305,15,1],[306,13,306,67,1],[307,13,307,67,1],[308,9,308,10,1],[311,9,311,10,1],[312,13,312,108,1],[313,13,313,59,1],[313,59,313,118,1],[313,118,313,120,1],[314,13,314,79,1],[315,9,315,10,1],[319,9,319,10,1],[320,13,320,117,1],[321,13,321,67,1],[322,9,322,10,1],[325,9,325,10,1],[326,13,326,108,1],[327,13,327,59,1],[327,59,327,104,1],[327,104,327,106,1],[328,13,328,79,1],[329,9,329,10,1],[332,9,332,10,1],[333,13,333,64,1],[334,13,334,67,1],[335,9,335,10,1],[338,9,338,10,1],[339,13,339,108,1],[340,13,340,59,1],[340,59,340,98,1],[340,98,340,100,1],[341,13,341,79,1],[342,9,342,10,1],[345,9,345,10,1],[346,13,346,66,1],[347,13,347,67,1],[348,9,348,10,1],[351,9,351,10,1],[352,13,352,108,1],[353,13,353,59,1],[353,59,353,100,1],[353,100,353,102,1],[354,13,354,79,1],[355,9,355,10,1],[358,9,358,10,1],[359,13,359,81,1],[360,13,360,48,1],[361,9,361,10,1],[364,9,364,10,1],[365,13,365,112,1],[366,13,366,59,1],[366,59,366,100,1],[366,100,366,102,1],[367,13,367,79,1],[368,9,368,10,1]]);
    </script>
  </body>
</html>