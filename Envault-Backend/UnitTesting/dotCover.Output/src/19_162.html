<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\ENVAULT\Envault-Backend\UnitTesting\AccountOpeningTest\AccountOpeningControllerTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using ApplicationLayer.Interfaces;
using CoreModels;
using CoreModels.Entities;
using CoreModels.Models;
using Envault_Backend.Controllers;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.Logging;
using Moq;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace UnitTesting.AccountOpeningTest
{
    public class AccountOpeningControllerTest
    {
        private AccountOpeningController _accountOpeningController;
        private Mock&lt;IAccountOpeningRepository&gt; _accountOpeningRepository;
        private Mock&lt;IUnitOfWork&gt; _unitOfWork;
        private Mock&lt;IConfiguration&gt; _mockConfig;
        private Mock&lt;ILogger&lt;AccountOpeningController&gt;&gt; _logger;
        [OneTimeSetUp]
        public void SetUp()
        {

        }
        [SetUp]
        public void ReintializeTest()
        {
            _unitOfWork = new Mock&lt;IUnitOfWork&gt;();
            _mockConfig = new Mock&lt;Microsoft.Extensions.Configuration.IConfiguration&gt;();
            _logger = new Mock&lt;ILogger&lt;AccountOpeningController&gt;&gt;();

            var configSection = new Mock&lt;IConfigurationSection&gt;();
            configSection.Setup(a =&gt; a.GetSection(&quot;key&quot;).Value).Returns(&quot;Devika@123#$%^&amp;*&amp;^%$#$%^&amp;*&amp;^%$#%^&amp;*(*&amp;$#@#%^&amp;*&amp;^$#%^&amp;*&amp;^$#$%^&amp;*&amp;^%$#$%&amp;*&amp;^$#$%&amp;*&quot;);
            configSection.Setup(a =&gt; a.GetSection(&quot;Issuer&quot;).Value).Returns(&quot;Devika@12345&quot;);
            configSection.Setup(a =&gt; a.GetSection(&quot;Audience&quot;).Value).Returns(&quot;Devika@12345&quot;);
            _mockConfig.Setup(a =&gt; a.GetSection(&quot;Jwt&quot;)).Returns(configSection.Object);

            _accountOpeningController = new AccountOpeningController(_unitOfWork.Object, configSection.Object, _logger.Object);
            _accountOpeningRepository = new Mock&lt;IAccountOpeningRepository&gt;();
            _unitOfWork.Setup(a =&gt; a.AccountOpeningRepository).Returns(_accountOpeningRepository.Object);
        }
        [Test]
        [TestCase(12345678903456, 9345678698, &quot;2000-01-01&quot;)]
        [TestCase(12349869879678, 8578676878, &quot;2003-09-07&quot;)]
        public void CheckUserExistence(long aadharNumber, long mobileNumber, string dateOfBirthString)
        {
            DateOnly dateOfBirth = DateOnly.Parse(dateOfBirthString);
            if(aadharNumber == 12345678903456)
            {
                _accountOpeningRepository.Setup(existence =&gt; existence.CheckUserExistence(aadharNumber, mobileNumber, dateOfBirth)).Returns(new BasicDetailsEntity());
                var response = _accountOpeningController.CheckUserExistence(aadharNumber, mobileNumber, dateOfBirth);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
            }
            else if(aadharNumber == 12349869879678)
            {
                _accountOpeningRepository.Setup(existence =&gt; existence.CheckUserExistence(aadharNumber, mobileNumber, dateOfBirth));
                var response = _accountOpeningController.CheckUserExistence(aadharNumber, mobileNumber, dateOfBirth);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
            }
        }
        [Test]
        public void CheckUserExistence_Exception()
        {
            DateOnly dateOfBirth = DateOnly.Parse(&quot;2001-09-07&quot;);
            _accountOpeningRepository.Setup(existence =&gt; existence.CheckUserExistence(12345, 345, dateOfBirth)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _accountOpeningController.CheckUserExistence(12345, 345, dateOfBirth);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        [TestCase(&quot;abc@gmail.com&quot;)]
        [TestCase(&quot;xyz@gmail.com&quot;)]
        public void IsUniqueEmail_Unique(string email)
        {
            if (email == &quot;abc@gmail.com&quot;)
            {
                _accountOpeningRepository.Setup(unique =&gt; unique.IsUniqueEmail(email)).Returns(true);
                var response = _accountOpeningController.IsUniqueEmail(email);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
            }
            else if(email == &quot;xyz@gmail.com&quot;)
            {
                _accountOpeningRepository.Setup(unique =&gt; unique.IsUniqueEmail(email)).Returns(false);
                var response = _accountOpeningController.IsUniqueEmail(email);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
            }
        }
        [Test]
        public void IsUniqueEmail_Exception()
        {
            _accountOpeningRepository.Setup(unique =&gt; unique.IsUniqueEmail(&quot;abc&quot;)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _accountOpeningController.IsUniqueEmail(&quot;abc&quot;);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        [TestCase(&quot;MKTGH0098H&quot;)]
        [TestCase(&quot;ACVGF3456K&quot;)]
        public void IsUniquePANNumber_Unique (string panNumber)
        {
            if (panNumber == &quot;MKTGH0098H&quot;)
            {
                _accountOpeningRepository.Setup(unique =&gt; unique.IsUniquePANNumber(panNumber)).Returns(true);
                var response = _accountOpeningController.IsUniquePANNumber(panNumber);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
            }
            else if (panNumber == &quot;ACVGF3456K&quot;)
            {
                _accountOpeningRepository.Setup(unique =&gt; unique.IsUniquePANNumber(panNumber)).Returns(false);
                var response = _accountOpeningController.IsUniquePANNumber(panNumber);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
            }
        }
        [Test]
        public void IsUniquePANNumber_Exception()
        {
            _accountOpeningRepository.Setup(unique =&gt; unique.IsUniquePANNumber(&quot;AAAAA0000A&quot;)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _accountOpeningController.IsUniquePANNumber(&quot;AAAAA0000A&quot;);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        public void GetAllBranches()
        {
            _accountOpeningRepository.Setup(branch =&gt; branch.GetAllBranches()).Returns([new BranchDetails()]);
            var response = _accountOpeningController.GetAllBranches();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        public void GetAllBranches_NoBranches()
        {
            _accountOpeningRepository.Setup(branch =&gt; branch.GetAllBranches()).Returns([]);
            var response = _accountOpeningController.GetAllBranches();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        public void GetAllBranches_Exception()
        {
            _accountOpeningRepository.Setup(branch =&gt; branch.GetAllBranches()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _accountOpeningController.GetAllBranches();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        public void CreateNewAccount()
        {
            var basicDetails = new BasicDetailsEntity
            {
                CustomerName = &quot;Vani&quot;,
                DateOfBirth = DateOnly.Parse(&quot;2003-06-02&quot;),
                Gender = &quot;Female&quot;,
                AadharNumber = 1234567893456,
                MobileNumber = 98765432085,
                PANNumber = &quot;MNHJT2345L&quot;,
                CustomerEmail = &quot;abc@gmail.com&quot;,
                EmployementType = &quot;Private Sector&quot;,
                AnnualIncome = 9876543,
                Nationality = true,
                TaxResidentOfIndia = true
            };
            _accountOpeningRepository.Setup(account =&gt; account.CreateNewAccount(basicDetails)).Returns(new {});
            var response = _accountOpeningController.CreateNewAccount(basicDetails);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
            _accountOpeningRepository.Setup(account =&gt; account.CreateNewAccount(basicDetails)).Returns(null);
            var failResponse = _accountOpeningController.CreateNewAccount(basicDetails);
            Assert.That(failResponse, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(failResponse.Result.Status, Is.True);
        }
        [Test]
        public void CreateNewAccount_Exception()
        {
            var basicDetails = new BasicDetailsEntity();
            _accountOpeningRepository.Setup(account =&gt; account.CreateNewAccount(basicDetails)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _accountOpeningController.CreateNewAccount(basicDetails);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        public void CreateAnotherAccount()
        {
            var account = new AccountsEntity()
            {
                AccountTypeId = 1
            };
            _accountOpeningRepository.Setup(customer =&gt; customer.CreateAnotherAccount(account)).Returns(new {});
            var response = _accountOpeningController.CreateAnotherAccount(account);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
            _accountOpeningRepository.Setup(customer =&gt; customer.CreateAnotherAccount(account));
            var failResponse = _accountOpeningController.CreateAnotherAccount(account);
            Assert.That(failResponse, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(failResponse.Result.Status, Is.True);
        }
        [Test]
        public void CreateAnotherAccount_Exception()
        {
            var account = new AccountsEntity();
            _accountOpeningRepository.Setup(customer =&gt; customer.CreateAnotherAccount(account)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _accountOpeningController.CreateAnotherAccount(account);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[26,9,26,10,1],[28,9,28,10,1],[31,9,31,10,1],[32,13,32,51,1],[33,13,33,89,1],[34,13,34,69,1],[36,13,36,67,1],[37,13,37,157,1],[38,13,38,92,1],[39,13,39,94,1],[40,13,40,87,1],[42,13,42,128,1],[43,13,43,79,1],[44,13,44,106,1],[45,9,45,10,1],[50,9,50,10,1],[51,13,51,70,1],[52,13,52,47,1],[53,13,53,14,1],[54,17,54,167,1],[55,17,55,118,1],[56,17,56,79,1],[57,17,57,62,1],[58,13,58,14,1],[59,18,59,52,1],[60,13,60,14,1],[61,17,61,133,1],[62,17,62,118,1],[63,17,63,79,1],[64,17,64,62,1],[65,13,65,14,1],[66,9,66,10,1],[69,9,69,10,1],[70,13,70,65,1],[71,13,71,159,1],[72,13,72,98,1],[73,13,73,75,1],[74,13,74,59,1],[75,9,75,10,1],[80,9,80,10,1],[81,13,81,42,1],[82,13,82,14,1],[83,17,83,102,1],[84,17,84,79,1],[85,17,85,79,1],[86,17,86,62,1],[87,13,87,14,1],[88,18,88,46,1],[89,13,89,14,1],[90,17,90,103,1],[91,17,91,79,1],[92,17,92,79,1],[93,17,93,62,1],[94,13,94,14,1],[95,9,95,10,1],[98,9,98,10,1],[99,13,99,130,1],[100,13,100,75,1],[101,13,101,75,1],[102,13,102,59,1],[103,9,103,10,1],[108,9,108,10,1],[109,13,109,43,1],[110,13,110,14,1],[111,17,111,110,1],[112,17,112,87,1],[113,17,113,79,1],[114,17,114,62,1],[115,13,115,14,1],[116,18,116,48,1],[117,13,117,14,1],[118,17,118,111,1],[119,17,119,87,1],[120,17,120,79,1],[121,17,121,62,1],[122,13,122,14,1],[123,9,123,10,1],[126,9,126,10,1],[127,13,127,141,1],[128,13,128,86,1],[129,13,129,75,1],[130,13,130,59,1],[131,9,131,10,1],[134,9,134,10,1],[135,13,135,111,1],[136,13,136,71,1],[137,13,137,75,1],[138,13,138,58,1],[139,9,139,10,1],[142,9,142,10,1],[143,13,143,92,1],[144,13,144,71,1],[145,13,145,75,1],[146,13,146,58,1],[147,9,147,10,1],[150,9,150,10,1],[151,13,151,126,1],[152,13,152,71,1],[153,13,153,75,1],[154,13,154,59,1],[155,9,155,10,1],[158,9,158,10,1],[159,13,172,15,1],[173,13,173,112,1],[174,13,174,85,1],[175,13,175,75,1],[176,13,176,58,1],[177,13,177,110,1],[178,13,178,89,1],[179,13,179,79,1],[180,13,180,62,1],[181,9,181,10,1],[184,9,184,10,1],[185,13,185,57,1],[186,13,186,142,1],[187,13,187,85,1],[188,13,188,75,1],[189,13,189,59,1],[190,9,190,10,1],[193,9,193,10,1],[194,13,197,15,1],[198,13,198,113,1],[199,13,199,84,1],[200,13,200,75,1],[201,13,201,58,1],[202,13,202,97,1],[203,13,203,88,1],[204,13,204,79,1],[205,13,205,62,1],[206,9,206,10,1],[209,9,209,10,1],[210,13,210,48,1],[211,13,211,143,1],[212,13,212,84,1],[213,13,213,75,1],[214,13,214,59,1],[215,9,215,10,1]]);
    </script>
  </body>
</html>