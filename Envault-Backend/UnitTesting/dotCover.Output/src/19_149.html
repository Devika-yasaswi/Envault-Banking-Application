<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\ENVAULT\Envault-Backend\UnitTesting\AccountOpeningTest\AccountOpeningControllerTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using ApplicationLayer.Interfaces;
using CoreModels;
using CoreModels.Entities;
using CoreModels.Models;
using Envault_Backend.Controllers;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.Logging;
using Moq;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace UnitTesting.AccountOpeningTest
{
    public class AccountOpeningControllerTest
    {
        private AccountOpeningController _accountOpeningController;
        private Mock&lt;IAccountOpeningRepository&gt; _accountOpeningRepository;
        private Mock&lt;IUnitOfWork&gt; _unitOfWork;
        private Mock&lt;IConfiguration&gt; _mockConfig;
        private Mock&lt;ILogger&lt;AccountOpeningController&gt;&gt; _logger;
        [OneTimeSetUp]
        public void SetUp()
        {

        }
        [SetUp]
        public void ReintializeTest()
        {
            _unitOfWork = new Mock&lt;IUnitOfWork&gt;();
            _mockConfig = new Mock&lt;Microsoft.Extensions.Configuration.IConfiguration&gt;();
            _logger = new Mock&lt;ILogger&lt;AccountOpeningController&gt;&gt;();

            var configSection = new Mock&lt;IConfigurationSection&gt;();
            configSection.Setup(a =&gt; a.GetSection(&quot;Key&quot;).Value).Returns(&quot;Devika@123#$%^&amp;*&amp;^%$#$%^&amp;*&amp;^%$#%^&amp;*(*&amp;$#@#%^&amp;*&amp;^$#%^&amp;*&amp;^$#$%^&amp;*&amp;^%$#$%&amp;*&amp;^$#$%&amp;*&quot;);
            configSection.Setup(a =&gt; a.GetSection(&quot;Issuer&quot;).Value).Returns(&quot;Devika@12345&quot;);
            configSection.Setup(a =&gt; a.GetSection(&quot;Audience&quot;).Value).Returns(&quot;Devika@12345&quot;);
            configSection.Setup(a =&gt; a[&quot;GenericMessages:Values:duplicateEmailError&quot;]).Returns(&quot;A user already exists with given email&quot;);
            configSection.Setup(a =&gt; a[&quot;GenericMessages:Values:duplicatePANError&quot;]).Returns(&quot;A user already exists with given PAN Number&quot;);
            configSection.Setup(a =&gt; a[&quot;GenericMessages:Values:LoadingBranchFail&quot;]).Returns(&quot;Unable to fetch all branches right now&quot;);

            _mockConfig.Setup(a =&gt; a.GetSection(&quot;Jwt&quot;)).Returns(configSection.Object);

            _accountOpeningController = new AccountOpeningController(_unitOfWork.Object, configSection.Object, _logger.Object);
            _accountOpeningRepository = new Mock&lt;IAccountOpeningRepository&gt;();
            _unitOfWork.Setup(a =&gt; a.AccountOpeningRepository).Returns(_accountOpeningRepository.Object);
        }
        [Test]
        [TestCase(12345678903456, 9345678698, &quot;2000-01-01&quot;)]
        [TestCase(12349869879678, 8578676878, &quot;2003-09-07&quot;)]
        public void CheckUserExistence(long aadharNumber, long mobileNumber, string dateOfBirthString)
        {
            DateOnly dateOfBirth = DateOnly.Parse(dateOfBirthString);
            if(aadharNumber == 12345678903456)
            {
                _accountOpeningRepository.Setup(existence =&gt; existence.CheckUserExistence(aadharNumber, mobileNumber, dateOfBirth)).Returns(new BasicDetailsEntity());
                var response = _accountOpeningController.CheckUserExistence(aadharNumber, mobileNumber, dateOfBirth);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
            }
            else if(aadharNumber == 12349869879678)
            {
                _accountOpeningRepository.Setup(existence =&gt; existence.CheckUserExistence(aadharNumber, mobileNumber, dateOfBirth));
                var response = _accountOpeningController.CheckUserExistence(aadharNumber, mobileNumber, dateOfBirth);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
            }
        }
        [Test]
        public void CheckUserExistence_Exception()
        {
            DateOnly dateOfBirth = DateOnly.Parse(&quot;2001-09-07&quot;);
            _accountOpeningRepository.Setup(existence =&gt; existence.CheckUserExistence(12345, 345, dateOfBirth)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _accountOpeningController.CheckUserExistence(12345, 345, dateOfBirth);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        [TestCase(&quot;abc@gmail.com&quot;)]
        [TestCase(&quot;xyz@gmail.com&quot;)]
        public void IsUniqueEmail(string email)
        {
            if (email == &quot;abc@gmail.com&quot;)
            {
                _accountOpeningRepository.Setup(unique =&gt; unique.IsUniqueEmail(email)).Returns(true);
                var response = _accountOpeningController.IsUniqueEmail(email);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
            }
            else if(email == &quot;xyz@gmail.com&quot;)
            {
                _accountOpeningRepository.Setup(unique =&gt; unique.IsUniqueEmail(email)).Returns(false);
                var response = _accountOpeningController.IsUniqueEmail(email);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
                Assert.That(response.Result.Data, Is.EqualTo(&quot;A user already exists with given email&quot;));
            }
        }
        [Test]
        public void IsUniqueEmail_Exception()
        {
            _accountOpeningRepository.Setup(unique =&gt; unique.IsUniqueEmail(&quot;abc&quot;)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _accountOpeningController.IsUniqueEmail(&quot;abc&quot;);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        [TestCase(&quot;MKTGH0098H&quot;)]
        [TestCase(&quot;ACVGF3456K&quot;)]
        public void IsUniquePANNumber (string panNumber)
        {
            if (panNumber == &quot;MKTGH0098H&quot;)
            {
                _accountOpeningRepository.Setup(unique =&gt; unique.IsUniquePANNumber(panNumber)).Returns(true);
                var response = _accountOpeningController.IsUniquePANNumber(panNumber);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
            }
            else if (panNumber == &quot;ACVGF3456K&quot;)
            {
                _accountOpeningRepository.Setup(unique =&gt; unique.IsUniquePANNumber(panNumber)).Returns(false);
                var response = _accountOpeningController.IsUniquePANNumber(panNumber);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
                Assert.That(response.Result.Data, Is.EqualTo(&quot;A user already exists with given PAN Number&quot;));
            }
        }
        [Test]
        public void IsUniquePANNumber_Exception()
        {
            _accountOpeningRepository.Setup(unique =&gt; unique.IsUniquePANNumber(&quot;AAAAA0000A&quot;)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _accountOpeningController.IsUniquePANNumber(&quot;AAAAA0000A&quot;);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        public void GetAllBranches()
        {
            _accountOpeningRepository.Setup(branch =&gt; branch.GetAllBranches()).Returns([new BranchDetails()]);
            var response = _accountOpeningController.GetAllBranches();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        public void GetAllBranches_NoBranches()
        {
            _accountOpeningRepository.Setup(branch =&gt; branch.GetAllBranches()).Returns([]);
            var response = _accountOpeningController.GetAllBranches();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
            Assert.That(response.Result.Data, Is.EqualTo(&quot;Unable to fetch all branches right now&quot;));
        }
        [Test]
        public void GetAllBranches_Exception()
        {
            _accountOpeningRepository.Setup(branch =&gt; branch.GetAllBranches()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _accountOpeningController.GetAllBranches();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        public void CreateNewAccount()
        {
            var basicDetails = new BasicDetailsEntity
            {
                CustomerName = &quot;Vani&quot;,
                DateOfBirth = DateOnly.Parse(&quot;2003-06-02&quot;),
                Gender = &quot;Female&quot;,
                AadharNumber = 1234567893456,
                MobileNumber = 98765432085,
                PANNumber = &quot;MNHJT2345L&quot;,
                CustomerEmail = &quot;abc@gmail.com&quot;,
                EmployementType = &quot;Private Sector&quot;,
                AnnualIncome = 9876543,
                Nationality = true,
                TaxResidentOfIndia = true
            };
            _accountOpeningRepository.Setup(account =&gt; account.CreateNewAccount(basicDetails)).Returns(new {});
            var response = _accountOpeningController.CreateNewAccount(basicDetails);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
            _accountOpeningRepository.Setup(account =&gt; account.CreateNewAccount(basicDetails)).Returns(null);
            var failResponse = _accountOpeningController.CreateNewAccount(basicDetails);
            Assert.That(failResponse, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(failResponse.Result.Status, Is.True);
        }
        [Test]
        public void CreateNewAccount_Exception()
        {
            var basicDetails = new BasicDetailsEntity();
            _accountOpeningRepository.Setup(account =&gt; account.CreateNewAccount(basicDetails)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _accountOpeningController.CreateNewAccount(basicDetails);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        public void CreateAnotherAccount()
        {
            var account = new AccountsEntity()
            {
                AccountTypeId = 1
            };
            _accountOpeningRepository.Setup(customer =&gt; customer.CreateAnotherAccount(account)).Returns(new {});
            var response = _accountOpeningController.CreateAnotherAccount(account);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
            _accountOpeningRepository.Setup(customer =&gt; customer.CreateAnotherAccount(account));
            var failResponse = _accountOpeningController.CreateAnotherAccount(account);
            Assert.That(failResponse, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(failResponse.Result.Status, Is.True);
        }
        [Test]
        public void CreateAnotherAccount_Exception()
        {
            var account = new AccountsEntity();
            _accountOpeningRepository.Setup(customer =&gt; customer.CreateAnotherAccount(account)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _accountOpeningController.CreateAnotherAccount(account);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[26,9,26,10,1],[28,9,28,10,1],[31,9,31,10,1],[32,13,32,51,1],[33,13,33,89,1],[34,13,34,69,1],[36,13,36,67,1],[37,13,37,157,1],[38,13,38,92,1],[39,13,39,94,1],[40,13,40,137,1],[41,13,41,140,1],[42,13,42,135,1],[44,13,44,87,1],[46,13,46,128,1],[47,13,47,79,1],[48,13,48,106,1],[49,9,49,10,1],[54,9,54,10,1],[55,13,55,70,1],[56,13,56,47,1],[57,13,57,14,1],[58,17,58,167,1],[59,17,59,118,1],[60,17,60,79,1],[61,17,61,62,1],[62,13,62,14,1],[63,18,63,52,1],[64,13,64,14,1],[65,17,65,133,1],[66,17,66,118,1],[67,17,67,79,1],[68,17,68,62,1],[69,13,69,14,1],[70,9,70,10,1],[73,9,73,10,1],[74,13,74,65,1],[75,13,75,159,1],[76,13,76,98,1],[77,13,77,75,1],[78,13,78,59,1],[79,9,79,10,1],[84,9,84,10,1],[85,13,85,42,1],[86,13,86,14,1],[87,17,87,102,1],[88,17,88,79,1],[89,17,89,79,1],[90,17,90,62,1],[91,13,91,14,1],[92,18,92,46,1],[93,13,93,14,1],[94,17,94,103,1],[95,17,95,79,1],[96,17,96,79,1],[97,17,97,62,1],[98,17,98,105,1],[99,13,99,14,1],[100,9,100,10,1],[103,9,103,10,1],[104,13,104,130,1],[105,13,105,75,1],[106,13,106,75,1],[107,13,107,59,1],[108,9,108,10,1],[113,9,113,10,1],[114,13,114,43,1],[115,13,115,14,1],[116,17,116,110,1],[117,17,117,87,1],[118,17,118,79,1],[119,17,119,62,1],[120,13,120,14,1],[121,18,121,48,1],[122,13,122,14,1],[123,17,123,111,1],[124,17,124,87,1],[125,17,125,79,1],[126,17,126,62,1],[127,17,127,110,1],[128,13,128,14,1],[129,9,129,10,1],[132,9,132,10,1],[133,13,133,141,1],[134,13,134,86,1],[135,13,135,75,1],[136,13,136,59,1],[137,9,137,10,1],[140,9,140,10,1],[141,13,141,111,1],[142,13,142,71,1],[143,13,143,75,1],[144,13,144,58,1],[145,9,145,10,1],[148,9,148,10,1],[149,13,149,92,1],[150,13,150,71,1],[151,13,151,75,1],[152,13,152,58,1],[153,13,153,101,1],[154,9,154,10,1],[157,9,157,10,1],[158,13,158,126,1],[159,13,159,71,1],[160,13,160,75,1],[161,13,161,59,1],[162,9,162,10,1],[165,9,165,10,1],[166,13,179,15,1],[180,13,180,112,1],[181,13,181,85,1],[182,13,182,75,1],[183,13,183,58,1],[184,13,184,110,1],[185,13,185,89,1],[186,13,186,79,1],[187,13,187,62,1],[188,9,188,10,1],[191,9,191,10,1],[192,13,192,57,1],[193,13,193,142,1],[194,13,194,85,1],[195,13,195,75,1],[196,13,196,59,1],[197,9,197,10,1],[200,9,200,10,1],[201,13,204,15,1],[205,13,205,113,1],[206,13,206,84,1],[207,13,207,75,1],[208,13,208,58,1],[209,13,209,97,1],[210,13,210,88,1],[211,13,211,79,1],[212,13,212,62,1],[213,9,213,10,1],[216,9,216,10,1],[217,13,217,48,1],[218,13,218,143,1],[219,13,219,84,1],[220,13,220,75,1],[221,13,221,59,1],[222,9,222,10,1]]);
    </script>
  </body>
</html>