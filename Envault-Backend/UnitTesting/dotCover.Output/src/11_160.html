<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\ENVAULT\Envault-Backend\UnitTesting\UserValidationTest\UserValidationControllerTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using ApplicationLayer.Interfaces;
using Castle.Core.Logging;
using CoreModels;
using DataAccessLayer.Infrastructure;
using Envault_Backend.Controllers;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.Logging;
using Moq;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace UnitTesting.UserValidationTest
{
    public class UserValidationControllerTest
    {
        private UserValidationController _userValidationController;
        private Mock&lt;IUserValidationRepository&gt; _userValidationRepository;
        private Mock&lt;IUnitOfWork&gt; _unitOfWork;
        private Mock&lt;IConfiguration&gt; _mockConfig;
        private Mock&lt;ILogger&lt;UserValidationController&gt;&gt; _logger;
        [OneTimeSetUp]
        public void SetUp()
        {

        }
        [SetUp]
        public void ReintializeTest()
        {
            _unitOfWork = new Mock&lt;IUnitOfWork&gt;();
            _mockConfig = new Mock&lt;Microsoft.Extensions.Configuration.IConfiguration&gt;();
            _logger = new Mock&lt;ILogger&lt;UserValidationController&gt;&gt;();

            var configSection = new Mock&lt;IConfigurationSection&gt;();
            configSection.Setup(a =&gt; a.GetSection(&quot;key&quot;).Value).Returns(&quot;Devika@123#$%^&amp;*&amp;^%$#$%^&amp;*&amp;^%$#%^&amp;*(*&amp;$#@#%^&amp;*&amp;^$#%^&amp;*&amp;^$#$%^&amp;*&amp;^%$#$%&amp;*&amp;^$#$%&amp;*&quot;);
            configSection.Setup(a =&gt; a.GetSection(&quot;Issuer&quot;).Value).Returns(&quot;Devika@12345&quot;);
            configSection.Setup(a =&gt; a.GetSection(&quot;Audience&quot;).Value).Returns(&quot;Devika@12345&quot;);
            _mockConfig.Setup(a =&gt; a.GetSection(&quot;Jwt&quot;)).Returns(configSection.Object);

            _userValidationController = new UserValidationController(_unitOfWork.Object, configSection.Object, _logger.Object);
            _userValidationRepository = new Mock&lt;IUserValidationRepository&gt;();
            _unitOfWork.Setup(a =&gt; a.UserValidationRepository).Returns(_userValidationRepository.Object);

            UserValidationController.generatedCaptcha = &quot;Asdfg4&quot;;
        }
        [Test]
        public void GenerateOtp()
        {
            _userValidationRepository.Setup(customer =&gt; customer.GenerateOtp()).Returns(123456);
            var response = _userValidationController.GenerateOtp();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
            _userValidationRepository.Setup(customer =&gt; customer.GenerateOtp()).Returns(0);
            var failResponse = _userValidationController.GenerateOtp();
            Assert.That(failResponse, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(failResponse.Result.Status, Is.True);
        }
        [Test]
        public void GenerateOtp_Exception()
        {
            _userValidationRepository.Setup(customer =&gt; customer.GenerateOtp()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _userValidationController.GenerateOtp();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        [TestCase(123456)]
        [TestCase(1111111)]
        public void ValidateOTP_Correct_OTP(int userEnteredOtp)
        {
            if(userEnteredOtp == 123456)
            {
                _userValidationRepository.Setup(otp =&gt; otp.ValidateOtp(0,userEnteredOtp)).Returns(true);
                var response = _userValidationController.ValidateOTP(userEnteredOtp);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
            }
            else if(userEnteredOtp == 1111111)
            {
                _userValidationRepository.Setup(otp =&gt; otp.ValidateOtp(0, userEnteredOtp)).Returns(false);
                var response = _userValidationController.ValidateOTP(userEnteredOtp);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
            }
        }
        [Test]
        public void ValidateOTP_Exception()
        {
            _userValidationRepository.Setup(otp =&gt; otp.ValidateOtp(0, 0)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _userValidationController.ValidateOTP(0);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        public void GenerateCaptcha()
        {
            _userValidationRepository.Setup(captcha =&gt; captcha.GenerateCaptcha()).Returns(&quot;Asdfg4&quot;);
            var response = _userValidationController.GenerateCaptcha();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        public void GenerateCaptcha_Exception()
        {
            _userValidationRepository.Setup(captcha =&gt; captcha.GenerateCaptcha()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _userValidationController.GenerateCaptcha();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        [TestCase(&quot;Asdfg4&quot;)]
        [TestCase(&quot;aSRTUI&quot;)]
        public void ValidateCaptcha_CorrectCaptcha(string userEnteredCaptcha)
        {
            if(userEnteredCaptcha == &quot;Asdfg4&quot;)
            {
                _userValidationRepository.Setup(captcha =&gt; captcha.ValidateCaptcha(It.IsAny&lt;string&gt;(), userEnteredCaptcha)).Returns(true);
                var response = _userValidationController.ValidateCaptcha(userEnteredCaptcha);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
            }
            else if(userEnteredCaptcha == &quot;aSRTUI&quot;)
            {
                _userValidationRepository.Setup(captcha =&gt; captcha.ValidateCaptcha(It.IsAny&lt;string&gt;(), userEnteredCaptcha)).Returns(false);
                var response = _userValidationController.ValidateCaptcha(userEnteredCaptcha);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
            }
        }
        [Test]
        public void ValidateCaptcha_Exception()
        {
            _userValidationRepository.Setup(captcha =&gt; captcha.ValidateCaptcha(It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;())).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _userValidationController.ValidateCaptcha(&quot;12&quot;);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[26,9,26,10,1],[28,9,28,10,1],[31,9,31,10,1],[32,13,32,51,1],[33,13,33,89,1],[34,13,34,69,1],[36,13,36,67,1],[37,13,37,157,1],[38,13,38,92,1],[39,13,39,94,1],[40,13,40,87,1],[42,13,42,128,1],[43,13,43,79,1],[44,13,44,106,1],[46,13,46,66,1],[47,9,47,10,1],[50,9,50,10,1],[51,13,51,97,1],[52,13,52,68,1],[53,13,53,75,1],[54,13,54,58,1],[55,13,55,92,1],[56,13,56,72,1],[57,13,57,79,1],[58,13,58,62,1],[59,9,59,10,1],[62,9,62,10,1],[63,13,63,127,1],[64,13,64,68,1],[65,13,65,75,1],[66,13,66,59,1],[67,9,67,10,1],[72,9,72,10,1],[73,13,73,41,1],[74,13,74,14,1],[75,17,75,105,1],[76,17,76,86,1],[77,17,77,79,1],[78,17,78,62,1],[79,13,79,14,1],[80,18,80,47,1],[81,13,81,14,1],[82,17,82,107,1],[83,17,83,86,1],[84,17,84,79,1],[85,17,85,62,1],[86,13,86,14,1],[87,9,87,10,1],[90,9,90,10,1],[91,13,91,121,1],[92,13,92,69,1],[93,13,93,75,1],[94,13,94,59,1],[95,9,95,10,1],[98,9,98,10,1],[99,13,99,101,1],[100,13,100,72,1],[101,13,101,75,1],[102,13,102,58,1],[103,9,103,10,1],[106,9,106,10,1],[107,13,107,129,1],[108,13,108,72,1],[109,13,109,75,1],[110,13,110,59,1],[111,9,111,10,1],[116,9,116,10,1],[117,13,117,47,1],[118,13,118,14,1],[119,17,119,139,1],[120,17,120,94,1],[121,17,121,79,1],[122,17,122,62,1],[123,13,123,14,1],[124,18,124,52,1],[125,13,125,14,1],[126,17,126,140,1],[127,17,127,94,1],[128,17,128,79,1],[129,17,129,62,1],[130,13,130,14,1],[131,9,131,10,1],[134,9,134,10,1],[135,13,135,167,1],[136,13,136,76,1],[137,13,137,75,1],[138,13,138,59,1],[139,9,139,10,1]]);
    </script>
  </body>
</html>