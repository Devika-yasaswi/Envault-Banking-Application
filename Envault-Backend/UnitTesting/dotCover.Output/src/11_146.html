<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\ENVAULT\Envault-Backend\UnitTesting\UserValidationTest\UserValidationControllerTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using ApplicationLayer.Interfaces;
using Castle.Core.Logging;
using CoreModels;
using DataAccessLayer.Infrastructure;
using Envault_Backend.Controllers;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.Logging;
using Moq;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace UnitTesting.UserValidationTest
{
    public class UserValidationControllerTest
    {
        private UserValidationController _userValidationController;
        private Mock&lt;IUserValidationRepository&gt; _userValidationRepository;
        private Mock&lt;IUnitOfWork&gt; _unitOfWork;
        private Mock&lt;IConfiguration&gt; _mockConfig;
        private Mock&lt;ILogger&lt;UserValidationController&gt;&gt; _logger;
        [OneTimeSetUp]
        public void SetUp()
        {

        }
        [SetUp]
        public void ReintializeTest()
        {
            _unitOfWork = new Mock&lt;IUnitOfWork&gt;();
            _mockConfig = new Mock&lt;Microsoft.Extensions.Configuration.IConfiguration&gt;();
            _logger = new Mock&lt;ILogger&lt;UserValidationController&gt;&gt;();

            var configSection = new Mock&lt;IConfigurationSection&gt;();
            configSection.Setup(a =&gt; a.GetSection(&quot;key&quot;).Value).Returns(&quot;Devika@123#$%^&amp;*&amp;^%$#$%^&amp;*&amp;^%$#%^&amp;*(*&amp;$#@#%^&amp;*&amp;^$#%^&amp;*&amp;^$#$%^&amp;*&amp;^%$#$%&amp;*&amp;^$#$%&amp;*&quot;);
            configSection.Setup(a =&gt; a.GetSection(&quot;Issuer&quot;).Value).Returns(&quot;Devika@12345&quot;);
            configSection.Setup(a =&gt; a.GetSection(&quot;Audience&quot;).Value).Returns(&quot;Devika@12345&quot;);
            _mockConfig.Setup(a =&gt; a.GetSection(&quot;Jwt&quot;)).Returns(configSection.Object);

            _userValidationController = new UserValidationController(_unitOfWork.Object, configSection.Object, _logger.Object);
            _userValidationRepository = new Mock&lt;IUserValidationRepository&gt;();
            _unitOfWork.Setup(a =&gt; a.UserValidationRepository).Returns(_userValidationRepository.Object);
        }
        [Test]
        public void GenerateOtp()
        {
            _userValidationRepository.Setup(customer =&gt; customer.GenerateOtp()).Returns(123456);
            var response = _userValidationController.GenerateOtp();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        public void GenerateOtp_Fail()
        {
            _userValidationRepository.Setup(customer =&gt; customer.GenerateOtp()).Returns(0);
            var response = _userValidationController.GenerateOtp();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        public void GenerateOtp_Exception()
        {
            _userValidationRepository.Setup(customer =&gt; customer.GenerateOtp()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _userValidationController.GenerateOtp();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        [TestCase(123456)]
        public void ValidateOTP_Correct_OTP(int userEnteredOtp)
        {
            _userValidationRepository.Setup(otp =&gt; otp.ValidateOtp(0,userEnteredOtp)).Returns(true);
            var response = _userValidationController.ValidateOTP(userEnteredOtp);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(123456)]
        public void ValidateOTP_WrongOTP(int userEnteredOtp)
        {
            _userValidationRepository.Setup(otp =&gt; otp.ValidateOtp(0, userEnteredOtp)).Returns(false);
            var response = _userValidationController.ValidateOTP(userEnteredOtp);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(123456)]
        public void ValidateOTP_Exception(int userEnteredOtp)
        {
            _userValidationRepository.Setup(otp =&gt; otp.ValidateOtp(0, userEnteredOtp)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _userValidationController.ValidateOTP(userEnteredOtp);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        public void GenerateCaptcha()
        {
            _userValidationRepository.Setup(captcha =&gt; captcha.GenerateCaptcha()).Returns(&quot;Asdfg4&quot;);
            var response = _userValidationController.GenerateCaptcha();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        public void GenerateCaptcha_Exception()
        {
            _userValidationRepository.Setup(captcha =&gt; captcha.GenerateCaptcha()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _userValidationController.GenerateCaptcha();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        [TestCase(&quot;Asdfg4&quot;)]
        public void ValidateCaptcha_CorrectCaptcha(string userEnteredCaptcha)
        {
            _userValidationRepository.Setup(captcha =&gt; captcha.ValidateCaptcha(null, userEnteredCaptcha)).Returns(true);
            var response = _userValidationController.ValidateCaptcha(userEnteredCaptcha);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(&quot;Asdfg4&quot;)]
        public void ValidateCaptcha_WrongCaptcha(string userEnteredCaptcha)
        {
            _userValidationRepository.Setup(captcha =&gt; captcha.ValidateCaptcha(null, userEnteredCaptcha)).Returns(false);
            var response = _userValidationController.ValidateCaptcha(userEnteredCaptcha);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(&quot;asdf&quot;)]
        public void ValidateCaptcha_Exception(string userEnteredCaptcha)
        {
            _userValidationRepository.Setup(captcha =&gt; captcha.ValidateCaptcha(It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;())).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _userValidationController.ValidateCaptcha(userEnteredCaptcha);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[26,9,26,10,1],[28,9,28,10,1],[31,9,31,10,1],[32,13,32,51,1],[33,13,33,89,1],[34,13,34,69,1],[36,13,36,67,1],[37,13,37,157,1],[38,13,38,92,1],[39,13,39,94,1],[40,13,40,87,1],[42,13,42,128,1],[43,13,43,79,1],[44,13,44,106,1],[45,9,45,10,1],[48,9,48,10,1],[49,13,49,97,1],[50,13,50,68,1],[51,13,51,75,1],[52,13,52,58,1],[53,9,53,10,1],[56,9,56,10,1],[57,13,57,92,1],[58,13,58,68,1],[59,13,59,75,1],[60,13,60,58,1],[61,9,61,10,1],[64,9,64,10,1],[65,13,65,127,1],[66,13,66,68,1],[67,13,67,75,1],[68,13,68,59,1],[69,9,69,10,1],[73,9,73,10,1],[74,13,74,101,1],[75,13,75,82,1],[76,13,76,75,1],[77,13,77,58,1],[78,9,78,10,1],[82,9,82,10,1],[83,13,83,103,1],[84,13,84,82,1],[85,13,85,75,1],[86,13,86,58,1],[87,9,87,10,1],[91,9,91,10,1],[92,13,92,134,1],[93,13,93,82,1],[94,13,94,75,1],[95,13,95,59,1],[96,9,96,10,1],[99,9,99,10,1],[100,13,100,101,1],[101,13,101,72,1],[102,13,102,75,1],[103,13,103,58,1],[104,9,104,10,1],[107,9,107,10,1],[108,13,108,129,1],[109,13,109,72,1],[110,13,110,75,1],[111,13,111,59,1],[112,9,112,10,1],[116,9,116,10,1],[117,13,117,121,1],[118,13,118,90,1],[119,13,119,75,1],[120,13,120,58,1],[121,9,121,10,1],[125,9,125,10,1],[126,13,126,122,1],[127,13,127,90,1],[128,13,128,75,1],[129,13,129,58,1],[130,9,130,10,1],[134,9,134,10,1],[135,13,135,167,1],[136,13,136,90,1],[137,13,137,75,1],[138,13,138,59,1],[139,9,139,10,1]]);
    </script>
  </body>
</html>