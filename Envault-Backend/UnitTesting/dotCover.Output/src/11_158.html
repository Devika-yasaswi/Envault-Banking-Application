<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\ENVAULT\Envault-Backend\UnitTesting\UserValidationTest\UserValidationControllerTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using ApplicationLayer.Interfaces;
using Castle.Core.Logging;
using CoreModels;
using DataAccessLayer.Infrastructure;
using Envault_Backend.Controllers;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.Logging;
using Moq;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace UnitTesting.UserValidationTest
{
    public class UserValidationControllerTest
    {
        private UserValidationController _userValidationController;
        private Mock&lt;IUserValidationRepository&gt; _userValidationRepository;
        private Mock&lt;IUnitOfWork&gt; _unitOfWork;
        private Mock&lt;IConfiguration&gt; _mockConfig;
        private Mock&lt;ILogger&lt;UserValidationController&gt;&gt; _logger;
        [OneTimeSetUp]
        public void SetUp()
        {

        }
        [SetUp]
        public void ReintializeTest()
        {
            _unitOfWork = new Mock&lt;IUnitOfWork&gt;();
            _mockConfig = new Mock&lt;Microsoft.Extensions.Configuration.IConfiguration&gt;();
            _logger = new Mock&lt;ILogger&lt;UserValidationController&gt;&gt;();

            var configSection = new Mock&lt;IConfigurationSection&gt;();
            configSection.Setup(a =&gt; a.GetSection(&quot;key&quot;).Value).Returns(&quot;Devika@123#$%^&amp;*&amp;^%$#$%^&amp;*&amp;^%$#%^&amp;*(*&amp;$#@#%^&amp;*&amp;^$#%^&amp;*&amp;^$#$%^&amp;*&amp;^%$#$%&amp;*&amp;^$#$%&amp;*&quot;);
            configSection.Setup(a =&gt; a.GetSection(&quot;Issuer&quot;).Value).Returns(&quot;Devika@12345&quot;);
            configSection.Setup(a =&gt; a.GetSection(&quot;Audience&quot;).Value).Returns(&quot;Devika@12345&quot;);
            _mockConfig.Setup(a =&gt; a.GetSection(&quot;Jwt&quot;)).Returns(configSection.Object);

            _userValidationController = new UserValidationController(_unitOfWork.Object, configSection.Object, _logger.Object);
            _userValidationRepository = new Mock&lt;IUserValidationRepository&gt;();
            _unitOfWork.Setup(a =&gt; a.UserValidationRepository).Returns(_userValidationRepository.Object);

            UserValidationController.generatedCaptcha = &quot;Asdfg4&quot;;
        }
        [Test]
        public void GenerateOtp()
        {
            _userValidationRepository.Setup(customer =&gt; customer.GenerateOtp()).Returns(123456);
            var response = _userValidationController.GenerateOtp();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        public void GenerateOtp_Fail()
        {
            _userValidationRepository.Setup(customer =&gt; customer.GenerateOtp()).Returns(0);
            var response = _userValidationController.GenerateOtp();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        public void GenerateOtp_Exception()
        {
            _userValidationRepository.Setup(customer =&gt; customer.GenerateOtp()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _userValidationController.GenerateOtp();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        [TestCase(123456)]
        public void ValidateOTP_Correct_OTP(int userEnteredOtp)
        {
            _userValidationRepository.Setup(otp =&gt; otp.ValidateOtp(0,userEnteredOtp)).Returns(true);
            var response = _userValidationController.ValidateOTP(userEnteredOtp);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(123456)]
        public void ValidateOTP_WrongOTP(int userEnteredOtp)
        {
            _userValidationRepository.Setup(otp =&gt; otp.ValidateOtp(0, userEnteredOtp)).Returns(false);
            var response = _userValidationController.ValidateOTP(userEnteredOtp);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(123456)]
        public void ValidateOTP_Exception(int userEnteredOtp)
        {
            _userValidationRepository.Setup(otp =&gt; otp.ValidateOtp(0, userEnteredOtp)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _userValidationController.ValidateOTP(userEnteredOtp);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        public void GenerateCaptcha()
        {
            _userValidationRepository.Setup(captcha =&gt; captcha.GenerateCaptcha()).Returns(&quot;Asdfg4&quot;);
            var response = _userValidationController.GenerateCaptcha();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        public void GenerateCaptcha_Exception()
        {
            _userValidationRepository.Setup(captcha =&gt; captcha.GenerateCaptcha()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _userValidationController.GenerateCaptcha();
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        [TestCase(&quot;Asdfg4&quot;)]
        public void ValidateCaptcha_CorrectCaptcha(string userEnteredCaptcha)
        {
            _userValidationRepository.Setup(captcha =&gt; captcha.ValidateCaptcha(It.IsAny&lt;string&gt;(), userEnteredCaptcha)).Returns(true);
            var response = _userValidationController.ValidateCaptcha(userEnteredCaptcha);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(&quot;Asdfg4&quot;)]
        public void ValidateCaptcha_WrongCaptcha(string userEnteredCaptcha)
        {
            _userValidationRepository.Setup(captcha =&gt; captcha.ValidateCaptcha(It.IsAny&lt;string&gt;(), userEnteredCaptcha)).Returns(false);
            var response = _userValidationController.ValidateCaptcha(userEnteredCaptcha);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(&quot;asdf&quot;)]
        public void ValidateCaptcha_Exception(string userEnteredCaptcha)
        {
            _userValidationRepository.Setup(captcha =&gt; captcha.ValidateCaptcha(It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;())).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _userValidationController.ValidateCaptcha(userEnteredCaptcha);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[26,9,26,10,1],[28,9,28,10,1],[31,9,31,10,1],[32,13,32,51,1],[33,13,33,89,1],[34,13,34,69,1],[36,13,36,67,1],[37,13,37,157,1],[38,13,38,92,1],[39,13,39,94,1],[40,13,40,87,1],[42,13,42,128,1],[43,13,43,79,1],[44,13,44,106,1],[46,13,46,66,1],[47,9,47,10,1],[50,9,50,10,1],[51,13,51,97,1],[52,13,52,68,1],[53,13,53,75,1],[54,13,54,58,1],[55,9,55,10,1],[58,9,58,10,1],[59,13,59,92,1],[60,13,60,68,1],[61,13,61,75,1],[62,13,62,58,1],[63,9,63,10,1],[66,9,66,10,1],[67,13,67,127,1],[68,13,68,68,1],[69,13,69,75,1],[70,13,70,59,1],[71,9,71,10,1],[75,9,75,10,1],[76,13,76,101,1],[77,13,77,82,1],[78,13,78,75,1],[79,13,79,58,1],[80,9,80,10,1],[84,9,84,10,1],[85,13,85,103,1],[86,13,86,82,1],[87,13,87,75,1],[88,13,88,58,1],[89,9,89,10,1],[93,9,93,10,1],[94,13,94,134,1],[95,13,95,82,1],[96,13,96,75,1],[97,13,97,59,1],[98,9,98,10,1],[101,9,101,10,1],[102,13,102,101,1],[103,13,103,72,1],[104,13,104,75,1],[105,13,105,58,1],[106,9,106,10,1],[109,9,109,10,1],[110,13,110,129,1],[111,13,111,72,1],[112,13,112,75,1],[113,13,113,59,1],[114,9,114,10,1],[118,9,118,10,1],[119,13,119,135,1],[120,13,120,90,1],[121,13,121,75,1],[122,13,122,58,1],[123,9,123,10,1],[127,9,127,10,1],[128,13,128,136,1],[129,13,129,90,1],[130,13,130,75,1],[131,13,131,58,1],[132,9,132,10,1],[136,9,136,10,1],[137,13,137,167,1],[138,13,138,90,1],[139,13,139,75,1],[140,13,140,59,1],[141,9,141,10,1]]);
    </script>
  </body>
</html>