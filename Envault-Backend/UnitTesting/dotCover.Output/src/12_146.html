<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\ENVAULT\Envault-Backend\UnitTesting\LoginAndRegistrationTest\LoginAndRegistrationControllerTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using ApplicationLayer.Interfaces;
using BusinessLogicLayer;
using Castle.Core.Logging;
using Castle.Core.Resource;
using CoreModels;
using CoreModels.Entities;
using Envault_Backend.Controllers;
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.Logging;
using Moq;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using UnitTesting.Utils;

namespace UnitTesting.LoginAndRegistrationTest
{
    public class LoginAndRegistrationControllerTest
    {
        private LoginAndRegistrationController _loginAndRegistrationController;
        private Mock&lt;ILoginAndRegistrationRepository&gt; _loginAndRegistrationRepository;
        private Mock&lt;IUnitOfWork&gt; _unitOfWork;
        private Mock&lt;IConfiguration&gt; _mockConfig;
        private Mock&lt;ILogger&lt;LoginAndRegistrationController&gt;&gt; _logger;
        private IQueryable&lt;LoginCredentialsEntity&gt; _loginCredentialsEntities;
       
        [OneTimeSetUp]
        public void SetUp()
        {
            _loginCredentialsEntities = DataIntializer.GetLoginCredentials();
        }
        [SetUp]
        public void ReintializeTest()
        {
            _unitOfWork = new Mock&lt;IUnitOfWork&gt;();
            _mockConfig = new Mock&lt;Microsoft.Extensions.Configuration.IConfiguration&gt;();
            _logger = new Mock&lt;ILogger&lt;LoginAndRegistrationController&gt;&gt;();

            var configSection = new Mock&lt;IConfigurationSection&gt;();
            configSection.Setup(a =&gt; a.GetSection(&quot;key&quot;).Value).Returns(&quot;Devika@123#$%^&amp;*&amp;^%$#$%^&amp;*&amp;^%$#%^&amp;*(*&amp;$#@#%^&amp;*&amp;^$#%^&amp;*&amp;^$#$%^&amp;*&amp;^%$#$%&amp;*&amp;^$#$%&amp;*&quot;);
            configSection.Setup(a =&gt; a.GetSection(&quot;Issuer&quot;).Value).Returns(&quot;Devika@12345&quot;);
            configSection.Setup(a =&gt; a.GetSection(&quot;Audience&quot;).Value).Returns(&quot;Devika@12345&quot;);
            _mockConfig.Setup(a =&gt; a.GetSection(&quot;Jwt&quot;)).Returns(configSection.Object);

            _loginAndRegistrationController = new LoginAndRegistrationController(_unitOfWork.Object, _mockConfig.Object, _logger.Object);
            _loginAndRegistrationRepository = new Mock&lt;ILoginAndRegistrationRepository&gt;();
            _unitOfWork.Setup(a =&gt; a.LoginAndRegistrationRepository).Returns(_loginAndRegistrationRepository.Object);
        }
        [Test]
        [TestCase(10000000)]
        [TestCase(10000001)]
        [TestCase(1234)]
        public void CheckUserExistence_UserExist(long customerId)
        {
            _loginAndRegistrationRepository.Setup(existence =&gt; existence.CheckUserExistence(customerId)).Returns(true);
            var response = _loginAndRegistrationController.CheckUserExistence(customerId);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.Multiple(() =&gt;
            {
                Assert.That(response.Result.Status, Is.True);
                Assert.That(response.Result.Data, Is.True);
            });
        }
        [Test]
        [TestCase(10000000)]
        [TestCase(10000001)]
        [TestCase(1234)]
        public void CheckUserExistence_UserDoesnotExist(long customerId) {
            _loginAndRegistrationRepository.Setup(existence =&gt; existence.CheckUserExistence(customerId)).Returns(false);
            var failResponse = _loginAndRegistrationController.CheckUserExistence(customerId);
            Assert.That(failResponse, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(failResponse.Result.Status, Is.True);
        }
        [Test]
        public void CheckUserExistence_Exception()
        {
            _loginAndRegistrationRepository.Setup(existence =&gt; existence.CheckUserExistence(1234)).Throws(new Exception(&quot;Something went wrong&quot;));
            var failResponse = _loginAndRegistrationController.CheckUserExistence(1234);
            Assert.That(failResponse, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(failResponse.Result.Status, Is.False);
        }
        [Test]
        [TestCase(10000000)]
        [TestCase(10000001)]
        [TestCase(1234)]
        public void IsRegisteredCustomer_Registered(long customerId) 
        {
            _loginAndRegistrationRepository.Setup(existence =&gt; existence.IsRegisteredCustomer(customerId)).Returns(true);
            var response = _loginAndRegistrationController.IsRegisteredCustomer(customerId);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(10000000)]
        [TestCase(10000001)]
        [TestCase(1234)]
        public void IsRegisteredCustomer_NotRegistered(long customerId)
        {
            _loginAndRegistrationRepository.Setup(existence =&gt; existence.IsRegisteredCustomer(customerId)).Returns(false);
            var response = _loginAndRegistrationController.IsRegisteredCustomer(customerId);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        public void IsRegisteredCustomer_Exception()
        {
            _loginAndRegistrationRepository.Setup(existence =&gt; existence.IsRegisteredCustomer(1234)).Throws(new Exception(&quot;Something went wrong&quot;));
            var failResponse = _loginAndRegistrationController.IsRegisteredCustomer(1234);
            Assert.That(failResponse, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(failResponse.Result.Status, Is.False);
        }
        [Test]
        [TestCase(1000000000, &quot;abc@123&quot;, &quot;Hello&quot;)]
        [TestCase(10000000, &quot;asdf&quot;, &quot;Welcome&quot;)]
        public void RegisterNewUser_Success(int customerId, string customerPassword, string securityMessage) 
        {
            var loginCredentials = new LoginCredentialsEntity
            {
                CustomerId = customerId,
                CustomerPassword = customerPassword,
                SecurityMessage = securityMessage
            };
            _loginAndRegistrationRepository.Setup(newUser =&gt; newUser.RegisterNewUser(loginCredentials)).Returns(true);
            var response = _loginAndRegistrationController.RegisterNewUser(loginCredentials);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(1000000000, &quot;abc@123&quot;, &quot;Hello&quot;)]
        [TestCase(10000000, &quot;asdf&quot;, &quot;Welcome&quot;)]
        public void RegisterNewUser_Fail(int customerId, string customerPassword, string securityMessage)
        {
            var loginCredentials = new LoginCredentialsEntity
            {
                CustomerId = customerId,
                CustomerPassword = customerPassword,
                SecurityMessage = securityMessage
            };
            _loginAndRegistrationRepository.Setup(newUser =&gt; newUser.RegisterNewUser(loginCredentials)).Returns(false);
            var response = _loginAndRegistrationController.RegisterNewUser(loginCredentials);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(1000000000, &quot;abc@123&quot;, &quot;Hello&quot;)]
        [TestCase(10000000, &quot;asdf&quot;, &quot;Welcome&quot;)]
        public void RegisterNewUser_Exception(int customerId, string customerPassword, string securityMessage)
        {
            var loginCredentials = new LoginCredentialsEntity
            {
                CustomerId = customerId,
                CustomerPassword = customerPassword,
                SecurityMessage = securityMessage
            };
            _loginAndRegistrationRepository.Setup(newUser =&gt; newUser.RegisterNewUser(loginCredentials)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _loginAndRegistrationController.RegisterNewUser(loginCredentials);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        [TestCase(1123456)]
        [TestCase(10000000)]
        public void GetUserSecurityMessage_ReturnsMessage(long customerId) 
        {
            _loginAndRegistrationRepository.Setup(customer =&gt; customer.GetUserSecurityMessage(customerId)).Returns(&quot;Hello&quot;);
            var response = _loginAndRegistrationController.GetUserSecurityMessage(customerId);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(1123456)]
        [TestCase(10000000)]
        public void GetUserSecurityMessage_Exception(long customerId)
        {
            _loginAndRegistrationRepository.Setup(customer =&gt; customer.GetUserSecurityMessage(customerId)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _loginAndRegistrationController.GetUserSecurityMessage(customerId);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        [TestCase(1000000, &quot;asdf&quot;)]
        public void ValidateUserToLogin_ValidUser(long customerId, string password) 
        {
            _loginAndRegistrationRepository.Setup(customer =&gt; customer.ValidateUserToLogin(customerId, password)).Returns(true);
            var response = _loginAndRegistrationController.ValidateUserToLogin(customerId, password);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(1000000, &quot;asdf&quot;)]
        public void ValidateUserToLogin_InvalidUser(long customerId, string password)
        {
            _loginAndRegistrationRepository.Setup(customer =&gt; customer.ValidateUserToLogin(customerId, password)).Returns(false);
            var response = _loginAndRegistrationController.ValidateUserToLogin(customerId, password);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(1000000, &quot;asdf&quot;)]
        public void ValidateUserToLogin_Exception(long customerId, string password)
        {
            _loginAndRegistrationRepository.Setup(customer =&gt; customer.ValidateUserToLogin(customerId, password)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _loginAndRegistrationController.ValidateUserToLogin(customerId, password);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        [TestCase(1234567)]
        public void CheckUserExistenceWithAadhar_UserExist(long aadharNumber) 
        {
            _loginAndRegistrationRepository.Setup(customer =&gt; customer.CheckUserExistenceWithAadhar(aadharNumber)).Returns(true);
            var response = _loginAndRegistrationController.CheckUserExistenceWithAadhar(aadharNumber);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(1234567)]
        public void CheckUserExistenceWithAadhar_UserDoesnotExist(long aadharNumber)
        {
            _loginAndRegistrationRepository.Setup(customer =&gt; customer.CheckUserExistenceWithAadhar(aadharNumber)).Returns(false);
            var response = _loginAndRegistrationController.CheckUserExistenceWithAadhar(aadharNumber);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(1234567)]
        public void CheckUserExistenceWithAadhar_Exception(long aadharNumber)
        {
            _loginAndRegistrationRepository.Setup(customer =&gt; customer.CheckUserExistenceWithAadhar(aadharNumber)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _loginAndRegistrationController.CheckUserExistenceWithAadhar(aadharNumber);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        [TestCase(1234567)]
        public void GetCustomerId(long aadharNumber) 
        {
            _loginAndRegistrationRepository.Setup(customer =&gt; customer.GetCustomerId(aadharNumber)).Returns(12345);
            var response = _loginAndRegistrationController.GetCustomerId(aadharNumber);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(1234567)]
        public void GetCustomerId_Exception(long aadharNumber)
        {
            _loginAndRegistrationRepository.Setup(customer =&gt; customer.GetCustomerId(aadharNumber)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _loginAndRegistrationController.GetCustomerId(aadharNumber);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        [TestCase(123456,&quot;hello&quot;)]
        public void ResetPassword(long customerId, string password) 
        {
            _loginAndRegistrationRepository.Setup(customer =&gt; customer.ResetPassword(customerId, password));
            var response = _loginAndRegistrationController.ResetPassword(customerId, password);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(123456, &quot;hello&quot;)]
        public void ResetPassword_Exception(long customerId, string password)
        {
            _loginAndRegistrationRepository.Setup(customer =&gt; customer.ResetPassword(customerId, password)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _loginAndRegistrationController.ResetPassword(customerId, password);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[33,9,33,10,1],[34,13,34,78,1],[35,9,35,10,1],[38,9,38,10,1],[39,13,39,51,1],[40,13,40,89,1],[41,13,41,75,1],[43,13,43,67,1],[44,13,44,157,1],[45,13,45,92,1],[46,13,46,94,1],[47,13,47,87,1],[49,13,49,138,1],[50,13,50,91,1],[51,13,51,118,1],[52,9,52,10,1],[58,9,58,10,1],[59,13,59,120,1],[60,13,60,91,1],[61,13,61,75,1],[62,13,63,13,1],[63,13,63,14,1],[63,14,64,17,1],[64,17,64,62,1],[64,62,65,17,1],[65,17,65,60,1],[65,60,66,13,1],[66,13,66,14,1],[66,14,66,16,1],[67,9,67,10,1],[72,74,72,75,1],[73,13,73,121,1],[74,13,74,95,1],[75,13,75,79,1],[76,13,76,62,1],[77,9,77,10,1],[80,9,80,10,1],[81,13,81,146,1],[82,13,82,89,1],[83,13,83,79,1],[84,13,84,63,1],[85,9,85,10,1],[91,9,91,10,1],[92,13,92,122,1],[93,13,93,93,1],[94,13,94,75,1],[95,13,95,58,1],[96,9,96,10,1],[102,9,102,10,1],[103,13,103,123,1],[104,13,104,93,1],[105,13,105,75,1],[106,13,106,58,1],[107,9,107,10,1],[110,9,110,10,1],[111,13,111,148,1],[112,13,112,91,1],[113,13,113,79,1],[114,13,114,63,1],[115,9,115,10,1],[120,9,120,10,1],[121,13,126,15,1],[127,13,127,119,1],[128,13,128,94,1],[129,13,129,75,1],[130,13,130,58,1],[131,9,131,10,1],[136,9,136,10,1],[137,13,142,15,1],[143,13,143,120,1],[144,13,144,94,1],[145,13,145,75,1],[146,13,146,58,1],[147,9,147,10,1],[152,9,152,10,1],[153,13,158,15,1],[159,13,159,151,1],[160,13,160,94,1],[161,13,161,75,1],[162,13,162,59,1],[163,9,163,10,1],[168,9,168,10,1],[169,13,169,125,1],[170,13,170,95,1],[171,13,171,75,1],[172,13,172,58,1],[173,9,173,10,1],[178,9,178,10,1],[179,13,179,154,1],[180,13,180,95,1],[181,13,181,75,1],[182,13,182,59,1],[183,9,183,10,1],[187,9,187,10,1],[188,13,188,129,1],[189,13,189,102,1],[190,13,190,75,1],[191,13,191,58,1],[192,9,192,10,1],[196,9,196,10,1],[197,13,197,130,1],[198,13,198,102,1],[199,13,199,75,1],[200,13,200,58,1],[201,9,201,10,1],[205,9,205,10,1],[206,13,206,161,1],[207,13,207,102,1],[208,13,208,75,1],[209,13,209,59,1],[210,9,210,10,1],[214,9,214,10,1],[215,13,215,130,1],[216,13,216,103,1],[217,13,217,75,1],[218,13,218,58,1],[219,9,219,10,1],[223,9,223,10,1],[224,13,224,131,1],[225,13,225,103,1],[226,13,226,75,1],[227,13,227,58,1],[228,9,228,10,1],[232,9,232,10,1],[233,13,233,162,1],[234,13,234,103,1],[235,13,235,75,1],[236,13,236,59,1],[237,9,237,10,1],[241,9,241,10,1],[242,13,242,116,1],[243,13,243,88,1],[244,13,244,75,1],[245,13,245,58,1],[246,9,246,10,1],[250,9,250,10,1],[251,13,251,147,1],[252,13,252,88,1],[253,13,253,75,1],[254,13,254,59,1],[255,9,255,10,1],[259,9,259,10,1],[260,13,260,109,1],[261,13,261,96,1],[262,13,262,75,1],[263,13,263,58,1],[264,9,264,10,1],[268,9,268,10,1],[269,13,269,155,1],[270,13,270,96,1],[271,13,271,75,1],[272,13,272,59,1],[273,9,273,10,1]]);
    </script>
  </body>
</html>