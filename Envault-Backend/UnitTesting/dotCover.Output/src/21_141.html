<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\ENVAULT\Envault-Backend\UnitTesting\AccountOpeningTest\AccountOpeningRepositoryTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using CoreModels.Entities;
using Moq;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using UnitTesting.Utils;

namespace UnitTesting.AccountOpeningTest
{
    public class AccountOpeningRepositoryTest : DbContextMock
    {
        [Test]
        public void CheckUserExistence()
        {
            var response = _accountOpeningRepository.CheckUserExistence(981234567890, 9876543210, DateOnly.Parse(&quot;1978-01-01&quot;));
            Assert.That(response.CustomerId, Is.EqualTo(10000001));
        }
        [Test]
        public void CheckUserExistence_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;BasicDetailsEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _accountOpeningRepository.CheckUserExistence(0,0, DateOnly.Parse(&quot;1978-01-01&quot;)));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        [TestCase(&quot;abc@gmail.com&quot;)]
        [TestCase(&quot;sriram@gmail.com&quot;)]
        public void IsUniqueEmail(string email)
        {
            var response = _accountOpeningRepository.IsUniqueEmail(email);
            if (email == &quot;abc@gmail.com&quot;)
                Assert.That(response, Is.True);
            else if (email == &quot;sriram@gmail.com&quot;)
                Assert.That(response, Is.False);
        }
        [Test]
        public void IsUniqueEmail_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;BasicDetailsEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _accountOpeningRepository.IsUniqueEmail(&quot;&quot;));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        [TestCase(&quot;MKTPK0515H&quot;)]
        [TestCase(&quot;MKTPK0515M&quot;)]
        public void IsUniquePANNumber(string panNumber)
        {
            var response = _accountOpeningRepository.IsUniquePANNumber(panNumber);
            if (panNumber == &quot;MKTPK0515H&quot;)
                Assert.That(response, Is.True);
            else if (panNumber == &quot;MKTPK0515M&quot;)
                Assert.That(response, Is.False);
        }
        [Test]
        public void IsUniquePANNumber_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;BasicDetailsEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _accountOpeningRepository.IsUniquePANNumber(&quot;&quot;));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        public void GetAllBranches()
        {
            var response = _accountOpeningRepository.GetAllBranches();
            Assert.That(response, Is.Not.Null);
        }
        [Test]
        public void GetAllBranches_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;BranchEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _accountOpeningRepository.GetAllBranches());
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        [TestCase(1)]
        [TestCase(7)]
        [TestCase(8)]
        public void GenerateAccountNumber(int accountTypeId)
        {
            AccountsEntity account = new() { AccountTypeId = accountTypeId };
            var response = _accountOpeningRepository.GenerateAccountNumber(account);

        }
        [Test]
        public void GenerateAccountNumber_Exception()
        {
            AccountsEntity account = new() { AccountTypeId=1 };
            _mockContext.Setup(a =&gt; a.Set&lt;AccountsEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _accountOpeningRepository.GenerateAccountNumber(account));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
        [Test]
        public void CreateNewAccount()
        {
            
        }
        [Test]
        public void CreateNewAccount_Exception()
        {
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _accountOpeningRepository.CreateNewAccount(new BasicDetailsEntity()));
            Assert.That(response.Message, Is.EqualTo(&quot;Object reference not set to an instance of an object.&quot;));
        }
        [Test]
        public void CreateAnotherAccount()
        {
            AccountsEntity account = new()
            {
                AccountNumber = 100000000005,
                CustomerId = 10000004,
                BranchID = 3,
                AccountBalance = 0,
                AccountTypeId = 3,
                FreezeWithdrawl = false,
                MaxBalanceWarningAmount = 0,
                MinBalanceWarningAmount = 0
            };
            var response = _accountOpeningRepository.CreateAnotherAccount(account);
            _mockContext.Verify(m =&gt; m.SaveChanges(), Times.Once);
        }
        [Test]
        public void CreateAnotherAccount_Exception()
        {
            _mockContext.Setup(a =&gt; a.Set&lt;BasicDetailsEntity&gt;()).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = Assert.Throws&lt;Exception&gt;(() =&gt; _accountOpeningRepository.CreateAnotherAccount(new AccountsEntity()));
            Assert.That(response.Message, Is.EqualTo(&quot;Something went wrong&quot;));
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[16,9,16,10,1],[17,13,17,129,1],[18,13,18,68,1],[19,9,19,10,1],[22,9,22,10,1],[23,13,23,112,1],[24,13,24,59,1],[24,59,24,138,1],[24,138,24,140,1],[25,13,25,79,1],[26,9,26,10,1],[31,9,31,10,1],[32,13,32,75,1],[33,13,33,42,1],[34,17,34,48,1],[35,18,35,50,1],[36,17,36,49,1],[37,9,37,10,1],[40,9,40,10,1],[41,13,41,112,1],[42,13,42,59,1],[42,59,42,102,1],[42,102,42,104,1],[43,13,43,79,1],[44,9,44,10,1],[49,9,49,10,1],[50,13,50,83,1],[51,13,51,43,1],[52,17,52,48,1],[53,18,53,48,1],[54,17,54,49,1],[55,9,55,10,1],[58,9,58,10,1],[59,13,59,112,1],[60,13,60,59,1],[60,59,60,106,1],[60,106,60,108,1],[61,13,61,79,1],[62,9,62,10,1],[65,9,65,10,1],[66,13,66,71,1],[67,13,67,48,1],[68,9,68,10,1],[71,9,71,10,1],[72,13,72,106,1],[73,13,73,59,1],[73,59,73,101,1],[73,101,73,103,1],[74,13,74,79,1],[75,9,75,10,1],[81,9,81,10,1],[82,13,82,78,1],[83,13,83,85,1],[85,9,85,10,1],[88,9,88,10,1],[89,13,89,64,1],[90,13,90,108,1],[91,13,91,59,1],[91,59,91,115,1],[91,115,91,117,1],[92,13,92,79,1],[93,9,93,10,1],[96,9,96,10,1],[98,9,98,10,1],[101,9,101,10,1],[102,13,102,59,1],[102,59,102,127,1],[102,127,102,129,1],[103,13,103,112,1],[104,9,104,10,1],[107,9,107,10,1],[108,13,118,15,1],[119,13,119,84,1],[120,13,120,67,1],[121,9,121,10,1],[124,9,124,10,1],[125,13,125,112,1],[126,13,126,59,1],[126,59,126,127,1],[126,127,126,129,1],[127,13,127,79,1],[128,9,128,10,1]]);
    </script>
  </body>
</html>