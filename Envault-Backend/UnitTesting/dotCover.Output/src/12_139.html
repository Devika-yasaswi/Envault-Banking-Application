<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\ENVAULT\Envault-Backend\UnitTesting\LoginAndRegistrationTest\LoginAndRegistrationControllerTest.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using ApplicationLayer.Interfaces;
using BusinessLogicLayer;
using Castle.Core.Logging;
using Castle.Core.Resource;
using CoreModels;
using CoreModels.Entities;
using Envault_Backend.Controllers;
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.Logging;
using Moq;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using UnitTesting.Utils;

namespace UnitTesting.LoginAndRegistrationTest
{
    public class LoginAndRegistrationControllerTest
    {
        private LoginAndRegistrationController _loginAndRegistrationController;
        private Mock&lt;ILoginAndRegistrationRepository&gt; _loginAndRegistrationRepository;
        private Mock&lt;IUnitOfWork&gt; _unitOfWork;
        private Mock&lt;IConfiguration&gt; _mockConfig;
        private Mock&lt;ILogger&lt;LoginAndRegistrationController&gt;&gt; _logger;
        private IQueryable&lt;LoginCredentialsEntity&gt; _loginCredentialsEntities;
       
        [OneTimeSetUp]
        public void SetUp()
        {
            _loginCredentialsEntities = DataIntializer.GetLoginCredentials();
        }
        [SetUp]
        public void ReintializeTest()
        {
            _unitOfWork = new Mock&lt;IUnitOfWork&gt;();
            _mockConfig = new Mock&lt;Microsoft.Extensions.Configuration.IConfiguration&gt;();
            _logger = new Mock&lt;ILogger&lt;LoginAndRegistrationController&gt;&gt;();

            var configSection = new Mock&lt;IConfigurationSection&gt;();
            configSection.Setup(a =&gt; a.GetSection(&quot;key&quot;).Value).Returns(&quot;Devika@123#$%^&amp;*&amp;^%$#$%^&amp;*&amp;^%$#%^&amp;*(*&amp;$#@#%^&amp;*&amp;^$#%^&amp;*&amp;^$#$%^&amp;*&amp;^%$#$%&amp;*&amp;^$#$%&amp;*&quot;);
            configSection.Setup(a =&gt; a.GetSection(&quot;Issuer&quot;).Value).Returns(&quot;Devika@12345&quot;);
            configSection.Setup(a =&gt; a.GetSection(&quot;Audience&quot;).Value).Returns(&quot;Devika@12345&quot;);
            _mockConfig.Setup(a =&gt; a.GetSection(&quot;Jwt&quot;)).Returns(configSection.Object);

            _loginAndRegistrationController = new LoginAndRegistrationController(_unitOfWork.Object, _mockConfig.Object, _logger.Object);
            _loginAndRegistrationRepository = new Mock&lt;ILoginAndRegistrationRepository&gt;();
            _unitOfWork.Setup(a =&gt; a.LoginAndRegistrationRepository).Returns(_loginAndRegistrationRepository.Object);
        }
        [Test]
        [TestCase(10000000)]
        [TestCase(12345)]
        public void CheckUserExistence(long customerId)
        {
            if (customerId == 10000000)
            {
                _loginAndRegistrationRepository.Setup(existence =&gt; existence.CheckUserExistence(customerId)).Returns(true);
                var response = _loginAndRegistrationController.CheckUserExistence(customerId);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.Multiple(() =&gt;
                {
                    Assert.That(response.Result.Status, Is.True);
                    Assert.That(response.Result.Data, Is.True);
                });
            }
            else if (customerId == 12345)
            {
                _loginAndRegistrationRepository.Setup(existence =&gt; existence.CheckUserExistence(customerId)).Returns(false);
                var failResponse = _loginAndRegistrationController.CheckUserExistence(customerId);
                Assert.That(failResponse, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(failResponse.Result.Status, Is.True);
            }
        }
        [Test]
        public void CheckUserExistence_Exception()
        {
            _loginAndRegistrationRepository.Setup(existence =&gt; existence.CheckUserExistence(1234)).Throws(new Exception(&quot;Something went wrong&quot;));
            var failResponse = _loginAndRegistrationController.CheckUserExistence(1234);
            Assert.That(failResponse, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(failResponse.Result.Status, Is.False);
        }
        [Test]
        [TestCase(10000000)]
        [TestCase(12345)]
        public void IsRegisteredCustomer(long customerId) 
        {
            if (customerId == 10000000)
            {
                _loginAndRegistrationRepository.Setup(existence =&gt; existence.IsRegisteredCustomer(customerId)).Returns(true);
                var response = _loginAndRegistrationController.IsRegisteredCustomer(customerId);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
            }
            else if (customerId == 12345)
            {
                _loginAndRegistrationRepository.Setup(existence =&gt; existence.IsRegisteredCustomer(customerId)).Returns(false);
                var response = _loginAndRegistrationController.IsRegisteredCustomer(customerId);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
            }
        }
        [Test]
        public void IsRegisteredCustomer_Exception()
        {
            _loginAndRegistrationRepository.Setup(existence =&gt; existence.IsRegisteredCustomer(1234)).Throws(new Exception(&quot;Something went wrong&quot;));
            var failResponse = _loginAndRegistrationController.IsRegisteredCustomer(1234);
            Assert.That(failResponse, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(failResponse.Result.Status, Is.False);
        }
        [Test]
        [TestCase(1000000000, &quot;abc@123&quot;, &quot;Hello&quot;)]
        [TestCase(12345, &quot;xyz@123&quot;, &quot;World&quot;)]
        public void RegisterNewUser_Success(int customerId, string customerPassword, string securityMessage) 
        {
            var loginCredentials = new LoginCredentialsEntity
            {
                CustomerId = customerId,
                CustomerPassword = customerPassword,
                SecurityMessage = securityMessage
            };
            if(customerId == 1000000000)
            {
                _loginAndRegistrationRepository.Setup(newUser =&gt; newUser.RegisterNewUser(loginCredentials)).Returns(true);
                var response = _loginAndRegistrationController.RegisterNewUser(loginCredentials);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
            }
            else if(customerId == 12345)
            {
                _loginAndRegistrationRepository.Setup(newUser =&gt; newUser.RegisterNewUser(loginCredentials)).Returns(false);
                var response = _loginAndRegistrationController.RegisterNewUser(loginCredentials);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
            }
        }
        [Test]
        [TestCase(1000000000, &quot;abc@123&quot;, &quot;Hello&quot;)]
        public void RegisterNewUser_Exception(int customerId, string customerPassword, string securityMessage)
        {
            var loginCredentials = new LoginCredentialsEntity
            {
                CustomerId = customerId,
                CustomerPassword = customerPassword,
                SecurityMessage = securityMessage
            };
            _loginAndRegistrationRepository.Setup(newUser =&gt; newUser.RegisterNewUser(loginCredentials)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _loginAndRegistrationController.RegisterNewUser(loginCredentials);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        [TestCase(1123456)]
        public void GetUserSecurityMessage_ReturnsMessage(long customerId) 
        {
            _loginAndRegistrationRepository.Setup(customer =&gt; customer.GetUserSecurityMessage(customerId)).Returns(&quot;Hello&quot;);
            var response = _loginAndRegistrationController.GetUserSecurityMessage(customerId);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(1123456)]
        public void GetUserSecurityMessage_Exception(long customerId)
        {
            _loginAndRegistrationRepository.Setup(customer =&gt; customer.GetUserSecurityMessage(customerId)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _loginAndRegistrationController.GetUserSecurityMessage(customerId);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        [TestCase(1000000, &quot;asdf&quot;)]
        [TestCase(12345, &quot;hello&quot;)]
        public void ValidateUserToLogin_ValidUser(long customerId, string password) 
        {
            if (customerId == 1000000)
            {
                _loginAndRegistrationRepository.Setup(customer =&gt; customer.ValidateUserToLogin(customerId, password)).Returns(true);
                var response = _loginAndRegistrationController.ValidateUserToLogin(customerId, password);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
            }
            else if (customerId == 12345)
            {
                _loginAndRegistrationRepository.Setup(customer =&gt; customer.ValidateUserToLogin(customerId, password)).Returns(false);
                var response = _loginAndRegistrationController.ValidateUserToLogin(customerId, password);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
            }
        }
        [Test]
        [TestCase(1000000, &quot;asdf&quot;)]
        public void ValidateUserToLogin_Exception(long customerId, string password)
        {
            _loginAndRegistrationRepository.Setup(customer =&gt; customer.ValidateUserToLogin(customerId, password)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _loginAndRegistrationController.ValidateUserToLogin(customerId, password);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        [TestCase(987654321989)]
        [TestCase(123456789034)]
        public void CheckUserExistenceWithAadhar(long aadharNumber) 
        {
            if(aadharNumber == 987654321989)
            {
                _loginAndRegistrationRepository.Setup(customer =&gt; customer.CheckUserExistenceWithAadhar(aadharNumber)).Returns(true);
                var response = _loginAndRegistrationController.CheckUserExistenceWithAadhar(aadharNumber);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
            }
            else if (aadharNumber == 123456789034)
            {
                _loginAndRegistrationRepository.Setup(customer =&gt; customer.CheckUserExistenceWithAadhar(aadharNumber)).Returns(false);
                var response = _loginAndRegistrationController.CheckUserExistenceWithAadhar(aadharNumber);
                Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
                Assert.That(response.Result.Status, Is.True);
            }
        }
        [Test]
        [TestCase(1234567)]
        public void CheckUserExistenceWithAadhar_Exception(long aadharNumber)
        {
            _loginAndRegistrationRepository.Setup(customer =&gt; customer.CheckUserExistenceWithAadhar(aadharNumber)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _loginAndRegistrationController.CheckUserExistenceWithAadhar(aadharNumber);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        [TestCase(1234567)]
        public void GetCustomerId(long aadharNumber) 
        {
            _loginAndRegistrationRepository.Setup(customer =&gt; customer.GetCustomerId(aadharNumber)).Returns(12345);
            var response = _loginAndRegistrationController.GetCustomerId(aadharNumber);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(1234567)]
        public void GetCustomerId_Exception(long aadharNumber)
        {
            _loginAndRegistrationRepository.Setup(customer =&gt; customer.GetCustomerId(aadharNumber)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _loginAndRegistrationController.GetCustomerId(aadharNumber);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
        [Test]
        [TestCase(123456,&quot;hello&quot;)]
        public void ResetPassword(long customerId, string password) 
        {
            _loginAndRegistrationRepository.Setup(customer =&gt; customer.ResetPassword(customerId, password));
            var response = _loginAndRegistrationController.ResetPassword(customerId, password);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.True);
        }
        [Test]
        [TestCase(123456, &quot;hello&quot;)]
        public void ResetPassword_Exception(long customerId, string password)
        {
            _loginAndRegistrationRepository.Setup(customer =&gt; customer.ResetPassword(customerId, password)).Throws(new Exception(&quot;Something went wrong&quot;));
            var response = _loginAndRegistrationController.ResetPassword(customerId, password);
            Assert.That(response, Is.InstanceOf&lt;Task&lt;GenericResponse&gt;&gt;());
            Assert.That(response.Result.Status, Is.False);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[33,9,33,10,1],[34,13,34,78,1],[35,9,35,10,1],[38,9,38,10,1],[39,13,39,51,1],[40,13,40,89,1],[41,13,41,75,1],[43,13,43,67,1],[44,13,44,157,1],[45,13,45,92,1],[46,13,46,94,1],[47,13,47,87,1],[49,13,49,138,1],[50,13,50,91,1],[51,13,51,118,1],[52,9,52,10,1],[57,9,57,10,1],[58,13,58,40,1],[59,13,59,14,1],[60,17,60,124,1],[61,17,61,95,1],[62,17,62,79,1],[63,17,64,17,1],[64,17,64,18,1],[64,18,65,21,1],[65,21,65,66,1],[65,66,66,21,1],[66,21,66,64,1],[66,64,67,17,1],[67,17,67,18,1],[67,18,67,20,1],[68,13,68,14,1],[69,18,69,42,1],[70,13,70,14,1],[71,17,71,125,1],[72,17,72,99,1],[73,17,73,83,1],[74,17,74,66,1],[75,13,75,14,1],[76,9,76,10,1],[79,9,79,10,1],[80,13,80,146,1],[81,13,81,89,1],[82,13,82,79,1],[83,13,83,63,1],[84,9,84,10,1],[89,9,89,10,1],[90,13,90,40,1],[91,13,91,14,1],[92,17,92,126,1],[93,17,93,97,1],[94,17,94,79,1],[95,17,95,62,1],[96,13,96,14,1],[97,18,97,42,1],[98,13,98,14,1],[99,17,99,127,1],[100,17,100,97,1],[101,17,101,79,1],[102,17,102,62,1],[103,13,103,14,1],[104,9,104,10,1],[107,9,107,10,1],[108,13,108,148,1],[109,13,109,91,1],[110,13,110,79,1],[111,13,111,63,1],[112,9,112,10,1],[117,9,117,10,1],[118,13,123,15,1],[124,13,124,41,1],[125,13,125,14,1],[126,17,126,123,1],[127,17,127,98,1],[128,17,128,79,1],[129,17,129,62,1],[130,13,130,14,1],[131,18,131,41,1],[132,13,132,14,1],[133,17,133,124,1],[134,17,134,98,1],[135,17,135,79,1],[136,17,136,62,1],[137,13,137,14,1],[138,9,138,10,1],[142,9,142,10,1],[143,13,148,15,1],[149,13,149,151,1],[150,13,150,94,1],[151,13,151,75,1],[152,13,152,59,1],[153,9,153,10,1],[157,9,157,10,1],[158,13,158,125,1],[159,13,159,95,1],[160,13,160,75,1],[161,13,161,58,1],[162,9,162,10,1],[166,9,166,10,1],[167,13,167,154,1],[168,13,168,95,1],[169,13,169,75,1],[170,13,170,59,1],[171,9,171,10,1],[176,9,176,10,1],[177,13,177,39,1],[178,13,178,14,1],[179,17,179,133,1],[180,17,180,106,1],[181,17,181,79,1],[182,17,182,62,1],[183,13,183,14,1],[184,18,184,42,1],[185,13,185,14,1],[186,17,186,134,1],[187,17,187,106,1],[188,17,188,79,1],[189,17,189,62,1],[190,13,190,14,1],[191,9,191,10,1],[195,9,195,10,1],[196,13,196,161,1],[197,13,197,102,1],[198,13,198,75,1],[199,13,199,59,1],[200,9,200,10,1],[205,9,205,10,1],[206,13,206,45,1],[207,13,207,14,1],[208,17,208,134,1],[209,17,209,107,1],[210,17,210,79,1],[211,17,211,62,1],[212,13,212,14,1],[213,18,213,51,1],[214,13,214,14,1],[215,17,215,135,1],[216,17,216,107,1],[217,17,217,79,1],[218,17,218,62,1],[219,13,219,14,1],[220,9,220,10,1],[224,9,224,10,1],[225,13,225,162,1],[226,13,226,103,1],[227,13,227,75,1],[228,13,228,59,1],[229,9,229,10,1],[233,9,233,10,1],[234,13,234,116,1],[235,13,235,88,1],[236,13,236,75,1],[237,13,237,58,1],[238,9,238,10,1],[242,9,242,10,1],[243,13,243,147,1],[244,13,244,88,1],[245,13,245,75,1],[246,13,246,59,1],[247,9,247,10,1],[251,9,251,10,1],[252,13,252,109,1],[253,13,253,96,1],[254,13,254,75,1],[255,13,255,58,1],[256,9,256,10,1],[260,9,260,10,1],[261,13,261,155,1],[262,13,262,96,1],[263,13,263,75,1],[264,13,264,59,1],[265,9,265,10,1]]);
    </script>
  </body>
</html>