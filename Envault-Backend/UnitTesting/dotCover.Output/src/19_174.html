<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\ENVAULT\Envault-Backend\Envault-Backend\Controllers\UserValidationController.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using ApplicationLayer.Interfaces;
using BusinessLogicLayer;
using CoreModels;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;

namespace Envault_Backend.Controllers
{
    [Route(&quot;api/[controller]&quot;)]
    [ApiController]
    public class UserValidationController : ControllerBase
    {
        private readonly UserValidationService _userValidationService;
        private readonly IConfiguration _configuration;
        private readonly ILogger&lt;UserValidationController&gt; _logger;
        public static int generatedOTP;
        private static string generatedCaptcha;
        public UserValidationController(IUnitOfWork unitOfWork, IConfiguration configuration, ILogger&lt;UserValidationController&gt; logger)
        {
            _userValidationService = new UserValidationService(unitOfWork);
            _configuration = configuration;
            _logger = logger;
        }
        [HttpGet]
        [Route(&quot;GenerateOtp&quot;)]
        public async Task&lt;GenericResponse&gt; GenerateOtp()
        {
            try
            {
                generatedOTP = await Task.FromResult(_userValidationService.GenerateOtp());
                if (generatedOTP != 0)
                    return new GenericResponse() { Status = true, Data = generatedOTP };
                else
                    return new GenericResponse() { Status = true };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpPost]
        [Route(&quot;ValidateOTP&quot;)]
        public async Task&lt;GenericResponse&gt; ValidateOTP(int userEnteredOtp)
        {
            try
            {
                bool ValidationResult = await Task.FromResult(_userValidationService.ValidateOtp(generatedOTP, userEnteredOtp));
                if (ValidationResult)
                    return new GenericResponse() { Status = true, Data = true };
                else
                    return new GenericResponse() { Status = true, Data = _configuration[&quot;GenericMessages:Values:OTPMismatched&quot;] };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpGet]
        [Route(&quot;GenerateCaptcha&quot;)]
        public async Task&lt;GenericResponse&gt; GenerateCaptcha()
        {
            try
            {
                generatedCaptcha = await Task.FromResult(_userValidationService.GenerateCaptcha());
                return new GenericResponse() { Status = true, Data = generatedCaptcha };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
        [HttpPost]
        [Route(&quot;ValidateCaptcha&quot;)]
        public async Task&lt;GenericResponse&gt; ValidateCaptcha(string userEnteredCaptcha)
        {
            try
            {
                bool result = await Task.FromResult(_userValidationService.ValidateCaptcha(generatedCaptcha, userEnteredCaptcha));
                if (result)
                {
                    _logger.LogInformation(&quot;CAPTCHA Matched&quot;);
                    return new GenericResponse() { Status = true, Data = result };
                }
                else
                {
                    _logger.LogInformation(_configuration[&quot;GenericMessages:Values:CAPTCHAMismatched&quot;]);
                    return new GenericResponse { Status = true, Data = _configuration[&quot;GenericMessages:Values:CAPTCHAMismatched&quot;] };
                }    
            }
            catch (Exception ex)
            {
                _logger.LogError(ex.Message);
                return new GenericResponse { Status = false, Error = new Error() { Description = &quot;&quot; } };
            }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[18,9,18,136,1],[19,9,19,10,1],[20,13,20,76,1],[21,13,21,44,1],[22,13,22,30,1],[23,9,23,10,1],[27,9,27,10,1],[29,13,29,14,1],[30,17,30,92,1],[31,17,31,39,1],[32,21,32,89,1],[34,21,34,68,1],[36,13,36,33,1],[37,13,37,14,1],[38,17,38,46,1],[39,17,39,105,1],[41,9,41,10,1],[45,9,45,10,1],[47,13,47,14,1],[48,17,48,129,1],[49,17,49,38,1],[50,21,50,81,1],[52,21,52,131,1],[54,13,54,33,1],[55,13,55,14,1],[56,17,56,46,1],[57,17,57,105,1],[59,9,59,10,1],[63,9,63,10,1],[65,13,65,14,1],[66,17,66,100,1],[67,17,67,89,1],[69,13,69,33,1],[70,13,70,14,1],[71,17,71,46,1],[72,17,72,105,1],[74,9,74,10,1],[78,9,78,10,1],[80,13,80,14,1],[81,17,81,131,1],[82,17,82,28,1],[83,17,83,18,0],[84,21,84,63,0],[85,21,85,83,0],[88,17,88,18,1],[89,21,89,104,1],[90,21,90,133,1],[93,13,93,33,1],[94,13,94,14,1],[95,17,95,46,1],[96,17,96,105,1],[98,9,98,10,1]]);
    </script>
  </body>
</html>